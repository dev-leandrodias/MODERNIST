{"cells":[{"cell_type":"markdown","metadata":{"id":"EKOTlwcmxmej"},"source":["# Selecionando sentenças dos originais\n","\n","Realiza a seleção de sentenças que possuem as palavras chaves os arquivos:\n","\n","- `original.zip`\n","- `originalpos.zip`\n","\n","Gera o arquivo:\n","\n","- `original_filtrado.zip`"]},{"cell_type":"markdown","metadata":{"id":"OP33KWAtBMWs"},"source":["# 1 Preparação do ambiente\n","\n","Preparação do ambiente para execução do script."]},{"cell_type":"markdown","metadata":{"id":"PKUr9Vk4BNLC"},"source":["## 1.1 Tempo inicial de processamento"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"JXclHCRQBSF2"},"outputs":[],"source":["# Import das bibliotecas.\n","import time\n","import datetime\n","\n","# Marca o tempo de início do processamento\n","inicio_processamento = time.time()"]},{"cell_type":"markdown","metadata":{"id":"GOcN8hK-scnt"},"source":["## 1.2 Funções e classes auxiliares"]},{"cell_type":"markdown","metadata":{"id":"OPRnA-mk5-c4"},"source":["Verifica se existe o diretório cohebert no diretório corrente.   \n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Fj5TaAH_5-nB"},"outputs":[],"source":["# Import das bibliotecas.\n","import os # Biblioteca para manipular arquivos\n","\n","# ============================  \n","def verificaDiretorioCoheBERT():\n","    \"\"\"\n","      Verifica se existe o diretório cohebert no diretório corrente.    \n","    \"\"\"\n","    \n","    # Verifica se o diretório existe\n","    if not os.path.exists(DIRETORIO_DADOS_CLINICOS):  \n","        # Cria o diretório\n","        os.makedirs(DIRETORIO_DADOS_CLINICOS)\n","        logging.info(\"Diretório Cohebert criado: {}\".format(DIRETORIO_DADOS_CLINICOS))\n","    \n","    return DIRETORIO_DADOS_CLINICOS"]},{"cell_type":"markdown","metadata":{"id":"yDCOeh2y5jOH"},"source":["Realiza o download e um arquivo"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"5B1mvfAU5jZf"},"outputs":[],"source":["# Import das bibliotecas.\n","import requests # Biblioteca de download\n","from tqdm.notebook import tqdm as tqdm_notebook # Biblioteca para barra de progresso\n","import os # Biblioteca para manipular arquivos\n","\n","def downloadArquivo(url_arquivo, nome_arquivo_destino):\n","    \"\"\"    \n","      Realiza o download de um arquivo de uma url em salva em nome_arquivo_destino.\n","    \n","      Parâmetros:\n","        `url_arquivo` - URL do arquivo a ser feito download.      \n","        `nome_arquivo_destino` - Nome do arquivo a ser salvo.      \n","    \"\"\"\n","    \n","    # Verifica se existe o diretório base\n","    DIRETORIO_DADOS_CLINICOS = verificaDiretorioCoheBERT()\n","    \n","    # Realiza o download de um arquivo em uma url\n","    data = requests.get(url_arquivo, stream=True)\n","    \n","    # Verifica se o arquivo existe\n","    if data.status_code != 200:\n","        logging.info(\"Exceção ao tentar realizar download {}. Response {}.\".format(url_arquivo, data.status_code))\n","        data.raise_for_status()\n","        return\n","\n","    # Recupera o nome do arquivo a ser realizado o download    \n","    nome_arquivo = nome_arquivo_destino.split(\"/\")[-1]  \n","\n","    # Define o nome e caminho do arquivo temporário    \n","    nome_arquivo_temporario = DIRETORIO_DADOS_CLINICOS + \"/\" + nome_arquivo + \"_part\"\n","    \n","    logging.info(\"Download do arquivo: {}.\".format(nome_arquivo_destino))\n","    \n","    # Baixa o arquivo\n","    with open(nome_arquivo_temporario, \"wb\") as arquivo_binario:        \n","        tamanho_conteudo = data.headers.get(\"Content-Length\")        \n","        total = int(tamanho_conteudo) if tamanho_conteudo is not None else None\n","        # Barra de progresso de download\n","        progresso_bar = tqdm_notebook(unit=\"B\", total=total, unit_scale=True)                \n","        # Atualiza a barra de progresso\n","        for chunk in data.iter_content(chunk_size=1024):        \n","            if chunk:                \n","                progresso_bar.update(len(chunk))\n","                arquivo_binario.write(chunk)\n","    \n","    # Renomeia o arquivo temporário para o arquivo definitivo\n","    os.rename(nome_arquivo_temporario, nome_arquivo_destino)\n","    \n","    # Fecha a barra de progresso.\n","    progresso_bar.close()"]},{"cell_type":"markdown","metadata":{"id":"ksYnRk7zLGp0"},"source":["Remove tags de um documento"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6qwKjGvyLG4v"},"outputs":[],"source":["def remove_tags(documento):\n","    \"\"\"\n","      Remove tags de um documento\n","    \"\"\"\n","    \n","    import re\n","\n","    documento_limpo = re.compile(\"<.*?>\")\n","    return re.sub(documento_limpo, \"\", documento)"]},{"cell_type":"markdown","metadata":{"id":"4pduTsINLeaz"},"source":["Funções auxiliares de arquivos"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"jirIzIstLea0"},"outputs":[],"source":["def carregar(nome_arquivo, encoding=\"Windows-1252\"):\n","    \"\"\"\n","      Carrega um arquivo texto e retorna as linhas como um único parágrafo(texto).\n","    \n","      Parâmetros:\n","        `nome_arquivo` - Nome do arquivo a ser carregado.  \n","    \"\"\"\n","\n","    # Abre o arquivo\n","    arquivo = open(nome_arquivo, \"r\", encoding= encoding)\n","    \n","    paragrafo = \"\"\n","    for linha in arquivo:\n","        linha = linha.splitlines()\n","        linha = \" \".join(linha)\n","        # Remove as tags existentes no final das linhas\n","        linha = remove_tags(linha)\n","        if linha != \"\":\n","          paragrafo = paragrafo + linha.strip() + \" \"\n","    \n","    # Fecha o arquivo\n","    arquivo.close()\n","\n","    # Remove os espaços em branco antes e depois do parágrafo\n","    return paragrafo.strip()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"EC9Xppq-_R0w"},"outputs":[],"source":["def carregarLista(nome_arquivo, encoding=\"Windows-1252\"):\n","    \"\"\"\n","      Carrega um arquivo texto e retorna as linhas como uma lista de sentenças(texto).\n","    \n","      Parâmetros:\n","        `nome_arquivo` - Nome do arquivo a ser carregado.   \n","        `encoding` - Codificação dos caracteres do arquivo.\n","    \"\"\"\n","\n","    # Abre o arquivo\n","    arquivo = open(nome_arquivo, \"r\", encoding= encoding)\n","    \n","    sentencas = []\n","    for linha in arquivo:        \n","        linha = linha.splitlines()\n","        linha = \" \".join(linha)\n","        linha = remove_tags(linha)\n","        if linha != \"\":\n","          sentencas.append(linha.strip())\n","    \n","    # Fecha o arquivo\n","    arquivo.close()\n","\n","    return sentencas "]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fkVk5LQT_G3f"},"outputs":[],"source":["def salvar(nome_arquivo,texto):                       \n","    \"\"\"\n","      Salva um texto em arquivo.\n","     \n","      Parâmetros:\n","        `nome_arquivo` - Nome do arquivo a ser salvo.\n","        `texto` - Texto a ser salvo.     \n","    \"\"\"\n","\n","    arquivo = open(nome_arquivo, \"w\")\n","    arquivo.write(str(texto))\n","    arquivo.close()"]},{"cell_type":"markdown","metadata":{"id":"603LYIYKBmq5"},"source":["Função auxiliar para formatar o tempo como `hh: mm: ss`"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Guy6B4whsZFR"},"outputs":[],"source":["# Import das bibliotecas.\n","import time\n","import datetime\n","\n","def formataTempo(tempo):\n","    \"\"\"\n","      Pega a tempo em segundos e retorna uma string hh:mm:ss\n","    \"\"\"\n","    # Arredonda para o segundo mais próximo.\n","    tempo_arredondado = int(round((tempo)))\n","    \n","    # Formata como hh:mm:ss\n","    return str(datetime.timedelta(seconds=tempo_arredondado))    "]},{"cell_type":"markdown","metadata":{"id":"zVKAapz7RCxk"},"source":["Classe(ModelArguments) de definição dos parâmetros do modelo"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zgmN6RqDRDZS"},"outputs":[],"source":["# Import das bibliotecas.\n","from dataclasses import dataclass, field\n","from typing import Dict, Optional\n","from typing import List\n","\n","@dataclass\n","class ModeloArgumentosMedida:\n","    max_seq_len: Optional[int] = field(\n","        default=None,\n","        metadata={\"help\": \"max seq len\"},\n","    )    \n","    pretrained_model_name_or_path: str = field(\n","        default=\"neuralmind/bert-base-portuguese-cased\",\n","        metadata={\"help\": \"nome do modelo pré-treinado do BERT.\"},\n","    )\n","    modelo_spacy: str = field(\n","        default=\"pt_core_news_lg\",\n","        metadata={\"help\": \"nome do modelo do spaCy.\"},\n","    )\n","    versao_modelo_spacy: str = field(\n","        default=\"-3.2.0\",\n","        metadata={\"help\": \"versão do nome do modelo no spaCy.\"},\n","    )\n","    sentenciar_documento: bool = field(\n","        default=True,\n","        metadata={\"help\": \"Dividir o documento em sentenças(frases).\"},\n","    )\n","    do_lower_case: bool = field(\n","        default=False,\n","        metadata={\"help\": \"define se o texto do modelo deve ser todo em minúsculo.\"},\n","    )    \n","    output_attentions: bool = field(\n","        default=False,\n","        metadata={\"help\": \"habilita se o modelo retorna os pesos de atenção.\"},\n","    )\n","    output_hidden_states: bool = field(\n","        default=False,\n","        metadata={\"help\": \"habilita gerar as camadas ocultas do modelo.\"},\n","    )\n","    usar_mcl_ajustado : bool = field(\n","        default=False,\n","        metadata={\"help\": \"habilita o carragamento de mcl ajustado.\"},\n","    )"]},{"cell_type":"markdown","metadata":{"id":"rceIwWa7UmFZ"},"source":["Biblioteca de limpeza de tela\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"PXTEvmuhUmjO"},"outputs":[],"source":["# Import das bibliotecas.\n","from IPython.display import clear_output"]},{"cell_type":"markdown","metadata":{"id":"iAPVtRXQqDim"},"source":["## 1.3 Tratamento de logs"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"DcopxbGZqDip"},"outputs":[],"source":["# Import das bibliotecas.\n","import logging # Biblioteca de logging\n","\n","# Formatando a mensagem de logging\n","logging.basicConfig(format=\"%(asctime)s : %(levelname)s : %(message)s\")\n","\n","logger = logging.getLogger()\n","logger.setLevel(logging.INFO)"]},{"cell_type":"markdown","metadata":{"id":"_GjYtXcMnSAe"},"source":["## 1.4 Identificando o ambiente Colab"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"YMiH0E3OnRa1"},"outputs":[],"source":["# Import das bibliotecas.\n","import sys # Biblioteca para acessar módulos do sistema\n","\n","# Se estiver executando no Google Colaboratory\n","# Retorna true ou false se estiver no Google Colaboratory\n","IN_COLAB = \"google.colab\" in sys.modules"]},{"cell_type":"markdown","metadata":{"id":"RinFHFesVKis"},"source":["## 1.5 Colaboratory"]},{"cell_type":"markdown","metadata":{"id":"MPngEboiVbfi"},"source":["Usando Colab GPU para Treinamento\n"]},{"cell_type":"markdown","metadata":{"id":"EjWE6WlvVbfj"},"source":["Uma GPU pode ser adicionada acessando o menu e selecionando:\n","\n","`Edit -> Notebook Settings -> Hardware accelerator -> (GPU)`\n","\n","Em seguida, execute a célula a seguir para confirmar que a GPU foi detectada."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3224,"status":"ok","timestamp":1670461703427,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"vtaYZmc3Vbfj","outputId":"d76e0276-2329-493e-9062-b134c078e03d"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:numexpr.utils:NumExpr defaulting to 2 threads.\n","INFO:root:Dispositivo GPU não encontrado\n"]}],"source":["# Import das bibliotecas.\n","import tensorflow as tf\n","\n","# Recupera o nome do dispositido da GPU.\n","device_name = tf.test.gpu_device_name()\n","\n","# O nome do dispositivo deve ser parecido com o seguinte:\n","if device_name == \"/device:GPU:0\":\n","    logging.info(\"Encontrei GPU em: {}\".format(device_name))\n","else:\n","    logging.info(\"Dispositivo GPU não encontrado\")\n","    #raise SystemError(\"Dispositivo GPU não encontrado\")"]},{"cell_type":"markdown","metadata":{"id":"iYRrUo2XWa8G"},"source":["Nome da GPU\n","\n","Para que a torch use a GPU, precisamos identificar e especificar a GPU como o dispositivo. Posteriormente, em nosso ciclo de treinamento, carregaremos dados no dispositivo.\n","\n","Vale a pena observar qual GPU você recebeu. A GPU Tesla P100 é muito mais rápido que as outras GPUs, abaixo uma lista ordenada:\n","- 1o Tesla P100\n","- 2o Tesla T4\n","- 3o Tesla P4 (Não tem memória para execução 4 x 8, somente 2 x 4)\n","- 4o Tesla K80 (Não tem memória para execução 4 x 8, somente 2 x 4)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zrjqDO6nWa8J"},"outputs":[],"source":["# Import das bibliotecas.\n","import torch # Biblioteca para manipular os tensores\n","\n","def getDeviceGPU():\n","    \"\"\"\n","    Retorna um dispositivo de GPU se disponível ou CPU.\n","    \n","    Retorno:\n","    `device` - Um device de GPU ou CPU.       \n","    \"\"\"\n","        \n","    # Se existe GPU disponível.\n","    if torch.cuda.is_available():\n","        \n","        # Diz ao PyTorch para usar GPU.    \n","        device = torch.device(\"cuda\")\n","        \n","        logging.info(\"Existem {} GPU(s) disponíveis.\".format(torch.cuda.device_count()))\n","        logging.info(\"Iremos usar a GPU: {}.\".format(torch.cuda.get_device_name(0)))\n","\n","    # Se não.\n","    else:        \n","        logging.info(\"Sem GPU disponível, usando CPU.\")\n","        device = torch.device(\"cpu\")\n","        \n","    return device"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":13,"status":"ok","timestamp":1670461705057,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"ChDxmtXsKwjf","outputId":"beb34d25-2c26-4556-f96f-8288cc31b8fb"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Sem GPU disponível, usando CPU.\n"]}],"source":["device = getDeviceGPU()"]},{"cell_type":"markdown","metadata":{"id":"kkdlEouHftcJ"},"source":["Conecta o modelo ao device"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"a-znVDGyfsVx"},"outputs":[],"source":["# Import das bibliotecas.\n","import torch # Biblioteca para manipular os tensores\n","\n","def conectaGPU(model, device):\n","    \"\"\"\n","      Conecta um modelo BERT a GPU.\n","\n","      Parâmetros:\n","        `model` - Um modelo BERT carregado.       \n","        `device` - Um device de GPU.     \n","    \n","      Retorno:\n","        `model` - Um objeto model BERT conectado a GPU.     \n","    \"\"\"\n","    # Associa a GPU ao modelo.\n","    model.to(device)\n","\n","    # Se existe GPU disponível.\n","    if torch.cuda.is_available():    \n","        # Diga ao pytorch para rodar este modelo na GPU.\n","        logging.info(\"Pytorch rodando o modelo na GPU.\")\n","        model.cuda()\n","        \n","    else:\n","        logging.info(\"Pytorch rodando sem GPU.\")\n","\n","    return model"]},{"cell_type":"markdown","metadata":{"id":"fGf59D0yVNx9"},"source":["Memória\n","\n","Memória disponível no ambiente"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1670461705058,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"1iC5-pSAVh7_","outputId":"b9459dea-3293-4e7c-cc8d-c4f76e378a5b"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Seu ambiente de execução tem  13.6 gigabytes de RAM disponível\n","\n","INFO:root:Para habilitar um tempo de execução de RAM alta, selecione menu o ambiente de execução> \"Alterar tipo de tempo de execução\"\n","INFO:root:e selecione High-RAM. Então, execute novamente está célula\n"]}],"source":["# Importando as bibliotecas.\n","from psutil import virtual_memory\n","\n","ram_gb = virtual_memory().total / 1e9\n","logging.info(\"Seu ambiente de execução tem {: .1f} gigabytes de RAM disponível\\n\".format(ram_gb))\n","\n","if ram_gb < 20:\n","  logging.info(\"Para habilitar um tempo de execução de RAM alta, selecione menu o ambiente de execução> \\\"Alterar tipo de tempo de execução\\\"\")\n","  logging.info(\"e selecione High-RAM. Então, execute novamente está célula\")\n","else:\n","  logging.info(\"Você está usando um ambiente de execução de memória RAM alta!\")"]},{"cell_type":"markdown","metadata":{"id":"wijMXooQQLcQ"},"source":["## 1.6 Monta uma pasta no google drive para carregar os arquivos de dados."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2161,"status":"ok","timestamp":1670461707214,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"ysnDDapMQK8K","outputId":"ce90df1e-aabe-4031-fdf7-0a9fd3024f9d"},"outputs":[{"name":"stdout","output_type":"stream","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}],"source":["#@title\n","# import necessário\n","from google.colab import drive\n","\n","# Monta o drive na pasta especificada\n","drive.mount(\"/content/drive\")     "]},{"cell_type":"markdown","metadata":{"id":"Pqa-7WXBAw8q"},"source":["## 1.9 Instalação do BERT da Hugging Face"]},{"cell_type":"markdown","metadata":{"id":"eCdqJCtQN52l"},"source":["Instala a interface pytorch para o BERT by Hugging Face. "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8184,"status":"ok","timestamp":1670461715394,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"1RfUN_KolV-f","outputId":"78efb10c-5737-4b1f-9ac4-e3d75db584f1"},"outputs":[{"name":"stdout","output_type":"stream","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: transformers==4.5.1 in /usr/local/lib/python3.8/dist-packages (4.5.1)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.8/dist-packages (from transformers==4.5.1) (21.3)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.8/dist-packages (from transformers==4.5.1) (3.8.0)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.8/dist-packages (from transformers==4.5.1) (4.64.1)\n","Requirement already satisfied: tokenizers<0.11,>=0.10.1 in /usr/local/lib/python3.8/dist-packages (from transformers==4.5.1) (0.10.3)\n","Requirement already satisfied: requests in /usr/local/lib/python3.8/dist-packages (from transformers==4.5.1) (2.23.0)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.8/dist-packages (from transformers==4.5.1) (1.21.6)\n","Requirement already satisfied: sacremoses in /usr/local/lib/python3.8/dist-packages (from transformers==4.5.1) (0.0.53)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.8/dist-packages (from transformers==4.5.1) (2022.6.2)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.8/dist-packages (from packaging->transformers==4.5.1) (3.0.9)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/dist-packages (from requests->transformers==4.5.1) (2022.9.24)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests->transformers==4.5.1) (2.10)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests->transformers==4.5.1) (1.24.3)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests->transformers==4.5.1) (3.0.4)\n","Requirement already satisfied: click in /usr/local/lib/python3.8/dist-packages (from sacremoses->transformers==4.5.1) (7.1.2)\n","Requirement already satisfied: six in /usr/local/lib/python3.8/dist-packages (from sacremoses->transformers==4.5.1) (1.15.0)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.8/dist-packages (from sacremoses->transformers==4.5.1) (1.2.0)\n"]}],"source":["!pip install -U transformers==4.5.1"]},{"cell_type":"markdown","metadata":{"id":"8bGda5JgMtQe"},"source":["# 2 Parametrização"]},{"cell_type":"markdown","metadata":{"id":"ifrYNTwGwKal"},"source":["## Gerais"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"5uiH9pNpwI6g"},"outputs":[],"source":["# Definição dos parâmetros a serem avaliados\n","\n","#Realiza o pooling dos tokens de palavras fora do vocabulário do BERT\n","POOLING_TOKENS = 1 # 1 - Sem pooling / 1 - Com pooling \n","\n","#Estratégia de recuperação dos embeddings: (1 - Embeddings da última camada, \n","#                                           2 - Embeddings da concatenação das 4 últimas camadas)\n","ESTRATEGIA_EMBEDDING = 1\n","\n","# DEVE SER UM NUMERO IMPAR E MAIOR OU IGUAL A 3\n","TAMANHO_JANELA = 3\n","DISTANCIA_DA_PALAVRA_ALVO = (TAMANHO_JANELA-1)/2"]},{"cell_type":"markdown","metadata":{"id":"mhByVujAwNAU"},"source":["## Específicos"]},{"cell_type":"markdown","metadata":{"id":"FhMuEM1o1Aq3"},"source":["Parâmetros do modelo"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"oJ15-ylRRRdD"},"outputs":[],"source":["# Definição dos parâmetros do Modelo.\n","model_args = ModeloArgumentosMedida(     \n","    max_seq_len = 512,\n","    #pretrained_model_name_or_path = \"https://neuralmind-ai.s3.us-east-2.amazonaws.com/nlp/bert-large-portuguese-cased/bert-large-portuguese-cased_pytorch_checkpoint.zip\",\n","    #pretrained_model_name_or_path = \"https://neuralmind-ai.s3.us-east-2.amazonaws.com/nlp/bert-base-portuguese-cased/bert-base-portuguese-cased_pytorch_checkpoint.zip\",\n","    pretrained_model_name_or_path = \"neuralmind/bert-large-portuguese-cased\",\n","    #pretrained_model_name_or_path = \"neuralmind/bert-base-portuguese-cased\",    \n","    #pretrained_model_name_or_path = \"bert-base-multilingual-cased\",\n","    #pretrained_model_name_or_path = \"bert-base-multilingual-uncased\",\n","    modelo_spacy = \"pt_core_news_lg\",\n","    #modelo_spacy = \"pt_core_news_md\",\n","    #modelo_spacy = \"pt_core_news_sm\",\n","    versao_modelo_spacy = \"3.2.0\",\n","    sentenciar_documento = True,\n","    do_lower_case = False,   # default True  \n","    output_attentions = False,  # default False\n","    output_hidden_states = True, # default False, se True retorna todas as camadas do modelo para as operações de soma e concatenação\n","    usar_mcl_ajustado = False, # Especifica se deve ser carregado um MCL ajustado ou pré-treinado. Necessário especificar o tipo do modelo em pretrained_model_name_or_path. \n",")"]},{"cell_type":"markdown","metadata":{"id":"BLOqjcIzImVo"},"source":["## Nome do diretório dos arquivos de dados"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"xJEiTPnKImVp"},"outputs":[],"source":["# Diretório do cohebert\n","DIRETORIO_DADOS_CLINICOS = \"MODERNIST\""]},{"cell_type":"markdown","metadata":{"id":"SUxlx7Sx4yxj"},"source":["## Define o caminho para os arquivos de dados"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-gQpxAO74yxj"},"outputs":[],"source":["# Diretório local para os arquivos pré-processados\n","DIRETORIO_LOCAL = \"/content/\" + DIRETORIO_DADOS_CLINICOS + \"/\"\n","\n","# Diretório no google drive com os arquivos pré-processados\n","DIRETORIO_DRIVE = \"/content/drive/MyDrive/Colab Notebooks/Data/\" + DIRETORIO_DADOS_CLINICOS + \"/\""]},{"cell_type":"markdown","metadata":{"id":"tDgJTbPOZ8SW"},"source":["## Inicialização diretórios"]},{"cell_type":"markdown","metadata":{"id":"qpSERA9TC4WU"},"source":["Diretório base local"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"edg7eW2cDflg"},"outputs":[],"source":["# Importando as bibliotecas.\n","import os\n","\n","def criaDiretorioLocal():\n","\n","  # Cria o diretório para receber os arquivos Originais e Permutados\n","  # Diretório a ser criado\n","  dirbase = DIRETORIO_LOCAL[:-1]\n","\n","  if not os.path.exists(dirbase):  \n","      # Cria o diretório\n","      os.makedirs(dirbase)    \n","      logging.info(\"Diretório criado: {}.\".format(dirbase))\n","  else:    \n","      logging.info(\"Diretório já existe: {}.\".format(dirbase))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":26,"status":"ok","timestamp":1670461715396,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"xge0ar9MJoKy","outputId":"5e565049-ad94-45ab-d385-fd859f602167"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Diretório já existe: /content/MODERNIST.\n"]}],"source":["criaDiretorioLocal()"]},{"cell_type":"markdown","metadata":{"id":"L7G3-MOsQ1N_"},"source":["# 3 spaCy"]},{"cell_type":"markdown","metadata":{"id":"35GwcgkOlWi3"},"source":["## 3.1 Download arquivo modelo\n","\n","https://spacy.io/models/pt"]},{"cell_type":"markdown","metadata":{"id":"PWd_9X0nOYnF"},"source":["### Função download modelo spaCy"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"DjWGu-9D5URZ"},"outputs":[],"source":["def downloadSpacy(model_args):\n","    \"\"\"\n","      Realiza o download do arquivo do modelo para o diretório corrente.\n","    \n","      Parâmetros:\n","        `model_args` - Objeto com os argumentos do modelo.       \n","    \"\"\"\n","    # Verifica se existe o diretório base\n","    DIRETORIO_DADOS_CLINICOS = verificaDiretorioCoheBERT()\n","        \n","    # Nome arquivo spacy\n","    ARQUIVO_MODELO_SPACY = model_args.modelo_spacy\n","    # Versão spaCy\n","    VERSAO_SPACY = \"-\" + model_args.versao_modelo_spacy\n","    # Nome arquivo compactado\n","    NOME_ARQUIVO_MODELO_COMPACTADO = ARQUIVO_MODELO_SPACY + VERSAO_SPACY + \".tar.gz\"\n","    \n","    # Url do arquivo\n","    URL_ARQUIVO_MODELO_COMPACTADO = \"https://github.com/explosion/spacy-models/releases/download/\" + ARQUIVO_MODELO_SPACY + VERSAO_SPACY + \"/\" + NOME_ARQUIVO_MODELO_COMPACTADO\n","\n","    # Realiza o download do arquivo do modelo\n","    logging.info(\"Download do arquivo do modelo do spaCy.\")\n","    downloadArquivo(URL_ARQUIVO_MODELO_COMPACTADO, DIRETORIO_DADOS_CLINICOS + \"/\" + NOME_ARQUIVO_MODELO_COMPACTADO)"]},{"cell_type":"markdown","metadata":{"id":"Uu_LkF7Nfm8_"},"source":["## 3.2 Descompacta o arquivo do modelo"]},{"cell_type":"markdown","metadata":{"id":"XAc1tSwvOc4d"},"source":["### Função descompacta modelo spaCy"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Dq9PnXO77bPQ"},"outputs":[],"source":["# Import das bibliotecas.\n","import tarfile # Biblioteca de descompactação\n","\n","def descompactaSpacy(model_args):\n","    \"\"\"\n","      Descompacta o arquivo do modelo.\n","    \n","      Parâmetros:\n","        `model_args` - Objeto com os argumentos do modelo.       \n","    \"\"\"\n","    \n","    # Verifica se existe o diretório base do cohebert e retorna o nome do diretório\n","    DIRETORIO_DADOS_CLINICOS = verificaDiretorioCoheBERT()\n","    \n","    # Nome arquivo spacy\n","    ARQUIVO_MODELO_SPACY = model_args.modelo_spacy\n","    # Versão spaCy\n","    VERSAO_SPACY = \"-\" + model_args.versao_modelo_spacy\n","    \n","    # Nome do arquivo a ser descompactado\n","    NOME_ARQUIVO_MODELO_COMPACTADO = DIRETORIO_DADOS_CLINICOS + \"/\" + ARQUIVO_MODELO_SPACY + VERSAO_SPACY + \".tar.gz\"\n","    \n","    logging.info(\"Descompactando o arquivo do modelo do spaCy.\")\n","    arquivo_tar = tarfile.open(NOME_ARQUIVO_MODELO_COMPACTADO, \"r:gz\")    \n","    arquivo_tar.extractall(DIRETORIO_DADOS_CLINICOS)    \n","    arquivo_tar.close()\n","    \n","    # Apaga o arquivo compactado\n","    if os.path.isfile(NOME_ARQUIVO_MODELO_COMPACTADO):        \n","        os.remove(NOME_ARQUIVO_MODELO_COMPACTADO)"]},{"cell_type":"markdown","metadata":{"id":"STHT2c89qvwK"},"source":["## 3.3 Carrega o modelo"]},{"cell_type":"markdown","metadata":{"id":"3iFBoyWMOgKz"},"source":["### Função carrega modelo spaCy"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1162,"status":"ok","timestamp":1670461716982,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"ePOccj0s8WMg","outputId":"e632951b-a5af-4cb9-e448-7973427d8a67"},"outputs":[{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.8/dist-packages/torch/cuda/__init__.py:497: UserWarning: Can't initialize NVML\n","  warnings.warn(\"Can't initialize NVML\")\n"]}],"source":["# Import das bibliotecas.\n","import spacy # Biblioteca do spaCy\n","\n","def carregaSpacy(model_args):\n","    \"\"\"\n","    Realiza o carregamento do Spacy.\n","    \n","    Parâmetros:\n","      `model_args` - Objeto com os argumentos do modelo.           \n","    \"\"\"\n","    \n","    # Verifica se existe o diretório base\n","    DIRETORIO_DADOS_CLINICOS = verificaDiretorioCoheBERT()\n","                  \n","    # Nome arquivo spacy\n","    ARQUIVO_MODELO_SPACY = model_args.modelo_spacy\n","    # Versão spaCy\n","    VERSAO_SPACY = \"-\" + model_args.versao_modelo_spacy\n","    # Caminho raoz do modelo do spaCy\n","    DIRETORIO_MODELO_SPACY =  DIRETORIO_DADOS_CLINICOS + \"/\" + ARQUIVO_MODELO_SPACY + VERSAO_SPACY\n","\n","    # Verifica se o diretório existe\n","    if os.path.exists(DIRETORIO_MODELO_SPACY) == False:\n","        # Realiza o download do arquivo modelo do spaCy\n","        downloadSpacy(model_args)\n","        # Descompacta o spaCy\n","        descompactaSpacy(model_args)\n","\n","    # Diretório completo do spaCy\n","    DIRETORIO_MODELO_SPACY = DIRETORIO_DADOS_CLINICOS + \"/\" + ARQUIVO_MODELO_SPACY + VERSAO_SPACY + \"/\" + ARQUIVO_MODELO_SPACY + \"/\" + ARQUIVO_MODELO_SPACY + VERSAO_SPACY + \"/\"\n","\n","    # Carrega o spaCy. Necessário somente \"tagger\" para encontrar os substantivos\n","    nlp = spacy.load(DIRETORIO_MODELO_SPACY)\n","    logging.info(\"spaCy carregado.\")\n","\n","    # Retorna o spacy carregado\n","    return nlp "]},{"cell_type":"markdown","metadata":{"id":"cAk5hHx7OnHn"},"source":["### Carrega o modelo spaCy\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":180},"executionInfo":{"elapsed":32654,"status":"ok","timestamp":1670461749630,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"nbELnrpgA4T1","outputId":"70eb7875-a9c7-4bc0-bbbc-2f9e92b3debd"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Download do arquivo do modelo do spaCy.\n","INFO:root:Download do arquivo: MODERNIST/pt_core_news_lg-3.2.0.tar.gz.\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"f75c377f4f1344799641b038b6a5b36f","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0.00/577M [00:00<?, ?B/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stderr","output_type":"stream","text":["INFO:root:Descompactando o arquivo do modelo do spaCy.\n","/usr/local/lib/python3.8/dist-packages/spacy/util.py:877: UserWarning: [W095] Model 'pt_core_news_lg' (3.2.0) was trained with spaCy v3.2 and may not be 100% compatible with the current version (3.4.3). If you see errors or degraded performance, download a newer compatible model or retrain your custom model with the current spaCy version. For more details and available updates, run: python -m spacy validate\n","  warnings.warn(warn_msg)\n","INFO:root:spaCy carregado.\n"]}],"source":["# Carrega o modelo spaCy\n","nlp = carregaSpacy(model_args)"]},{"cell_type":"markdown","metadata":{"id":"fzk8VOp7oy8n"},"source":["## 3.4 Funções auxiliares spaCy"]},{"cell_type":"markdown","metadata":{"id":"AEzytjZi5Iw2"},"source":["### getStopwords\n","\n","Recupera as stopwords do spaCy"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zKg-_XyWoy8o"},"outputs":[],"source":["def getStopwords(nlp):\n","    \"\"\"\n","      Recupera as stop words do nlp(Spacy).\n","    \n","      Parâmetros:\n","        `nlp` - Um modelo spaCy carregado.           \n","    \"\"\"\n","    \n","    spacy_stopwords = nlp.Defaults.stop_words\n","\n","    return spacy_stopwords "]},{"cell_type":"markdown","metadata":{"id":"qZdNFrC3oy8p"},"source":["Lista dos stopwords"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":27,"status":"ok","timestamp":1670461749631,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"s1o8jevtoy8p","outputId":"a6e80002-0d38-452b-a59d-c87bf16ceda3"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Quantidade de stopwords: 416.\n"]},{"name":"stdout","output_type":"stream","text":["{'a', 'naquela', 'pois', 'posição', 'nos', 'cada', 'aqueles', 'quinto', 'certeza', 'logo', 'então', 'ambas', 'tens', 'eu', 'tais', 'inclusive', 'aí', 'grande', 'sexto', 'dão', 'corrente', 'pela', 'seu', 'uns', 'todos', 'duas', 'estivemos', 'maioria', 'muito', 'estive', 'porquanto', 'terceira', 'momento', 'puderam', 'boa', 'foste', 'mesmo', 'essas', 'esteve', 'nuns', 'algo', 'quieto', 'ainda', 'usar', 'ligado', 'fomos', 'iniciar', 'comprido', 'valor', 'nesse', 'bem', 'outras', 'sobre', 'lugar', 'tipo', 'final', 'nós', 'uma', 'vindo', 'poder', 'aquilo', 'fostes', 'aquelas', 'ponto', 'caminho', 'seis', 'conhecido', 'primeiro', 'apoia', 'sua', 'nossos', 'doze', 'desse', 'dezassete', 'desde', 'inicio', 'do', 'dá', 'próximo', 'ali', 'parte', 'nesta', 'zero', 'povo', 'números', 'está', 'mês', 'novo', 'só', 'atrás', 'alguns', 'quer', 'nova', 'os', 'estas', 'fui', 'nossas', 'porque', 'vez', 'fez', 'esta', 'pouca', 'porém', 'parece', 'têm', 'teve', 'ter', 'neste', 'estás', 'tiveste', 'estes', 'comprida', 'nem', 'até', 'tu', 'deverá', 'foram', 'embora', 'coisa', 'algumas', 'ver', 'treze', 'maior', 'deste', 'tanta', 'dar', 'teus', 'seus', 'falta', 'tal', 'podia', 'dos', 'numa', 'tendes', 'área', 'isto', 'fazer', 'exemplo', 'as', 'outros', 'menor', 'três', 'tentaram', 'tivemos', 'tente', 'se', 'da', 'essa', 'que', 'apenas', 'qual', 'somos', 'és', 'todo', 'lá', 'tentei', 'quê', 'dizer', 'sei', 'talvez', 'obrigada', 'tiveram', 'vos', 'seria', 'sexta', 'cinco', 'demais', 'teu', 'fazemos', 'próxima', 'cá', 'catorze', 'nessa', 'tenho', 'devem', 'este', 'lado', 'muitos', 'aquele', 'estão', 'apoio', 'põem', 'cujo', 'sim', 'na', 'tivestes', 'conhecida', 'sou', 'sob', 'te', 'vós', 'dez', 'vezes', 'também', 'fazem', 'conselho', 'sétimo', 'vinda', 'minhas', 'ir', 'adeus', 'faz', 'somente', 'com', 'vêm', 'dessa', 'estava', 'sempre', 'tão', 'para', 'quero', 'custa', 'ademais', 'obrigado', 'quarto', 'assim', 'nível', 'era', 'vossa', 'não', 'des', 'dentro', 'fazia', 'sois', 'além', 'dezoito', 'ser', 'debaixo', 'num', 'possível', 'quanto', 'nada', 'longe', 'vais', 'esse', 'diante', 'por', 'mais', 'tempo', 'daquela', 'sistema', 'disso', 'favor', 'sétima', 'fazes', 'número', 'veja', 'de', 'cento', 'das', 'nosso', 'o', 'vários', 'meus', 'estado', 'cedo', 'podem', 'vossas', 'contra', 'nunca', 'vai', 'quarta', 'mil', 'tentar', 'pegar', 'faço', 'às', 'vão', 'são', 'lhe', 'ora', 'querem', 'questão', 'temos', 'vosso', 'daquele', 'sabe', 'nove', 'quando', 'tem', 'novas', 'eles', 'oitavo', 'próprio', 'umas', 'pontos', 'tudo', 'bom', 'máximo', 'posso', 'dezasseis', 'poderá', 'fazeis', 'contudo', 'relação', 'geral', 'forma', 'pouco', 'acerca', 'depois', 'sem', 'mal', 'certamente', 'meio', 'tuas', 'e', 'qualquer', 'tarde', 'vossos', 'vem', 'minha', 'tive', 'tua', 'apontar', 'partir', 'irá', 'onze', 'pôde', 'estará', 'estiveste', 'aquela', 'eventual', 'fará', 'vens', 'pode', 'bastante', 'através', 'desta', 'menos', 'perto', 'quieta', 'ontem', 'já', 'grupo', 'estiveram', 'meu', 'entre', 'ambos', 'você', 'um', 'diz', 'após', 'mas', 'pelas', 'quatro', 'oito', 'terceiro', 'quinze', 'cuja', 'ao', 'vocês', 'local', 'segundo', 'me', 'à', 'pelo', 'grandes', 'elas', 'possivelmente', 'isso', 'portanto', 'maiorias', 'é', 'dizem', 'fim', 'suas', 'tanto', 'porquê', 'nossa', 'estar', 'direita', 'aqui', 'quinta', 'nenhuma', 'antes', 'deve', 'estou', 'dois', 'sete', 'nas', 'primeira', 'vinte', 'usa', 'outra', 'ou', 'for', 'como', 'oitava', 'cima', 'quem', 'novos', 'agora', 'enquanto', 'segunda', 'meses', 'foi', 'todas', 'toda', 'estivestes', 'ela', 'ele', 'no', 'pelos', 'breve', 'dezanove', 'esses', 'baixo', 'põe', 'naquele', 'fora', 'saber', 'onde', 'último', 'em', 'aos', 'quais'}\n"]}],"source":["logging.info(\"Quantidade de stopwords: {}.\".format(len(getStopwords(nlp))))\n","\n","print(getStopwords(nlp))"]},{"cell_type":"markdown","metadata":{"id":"onM1ZApom-_W"},"source":["### getVerbos\n","Localiza os verbos da sentença"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6hdqVdfxm-_W"},"outputs":[],"source":["# Import das bibliotecas.\n","import spacy   \n","from spacy.util import filter_spans\n","from spacy.matcher import Matcher\n","\n","# (verbo normal como auxilar ou auxilar) + vários verbos auxiliares +verbo principal ou verbo auxiliar\n","gramaticav1 =  [\n","                {\"POS\": \"AUX\", \"OP\": \"?\", \"DEP\": {\"IN\": [\"aux\",\"aux:pass\"]}},  #verbo auxiliar                                  \n","                {\"POS\": \"VERB\", \"OP\": \"?\", \"DEP\": {\"IN\": [\"ROOT\",\"aux\",\"xcomp\",\"aux:pass\"]}},  #verbo normal como auxiliar\n","                {\"POS\": \"AUX\", \"OP\": \"*\", \"DEP\": {\"IN\": [\"aux\",\"xcomp\",\"aux:pass\"]}},  #verbo auxiliar   \n","                {\"POS\": \"VERB\", \"OP\": \"+\"}, #verbo principal\n","                {\"POS\": \"AUX\", \"OP\": \"?\", \"DEP\": {\"IN\": [\"cop\",\"aux\",\"xcomp\",\"aux:pass\"]}},  #verbo auxiliar\n","               ] \n","\n","# verbo auxiliar + verbo normal como auxiliar + conjunção com preposição + verbo\n","gramaticav2 =  [               \n","                {\"POS\": \"AUX\", \"OP\": \"?\", \"DEP\": {\"IN\": [\"aux\",\"aux:pass\"]}},  #verbo auxiliar                   \n","                {\"POS\": \"VERB\", \"OP\": \"+\", \"DEP\": {\"IN\": [\"ROOT\"]}},  #verbo principal       \n","                {\"POS\": \"SCONJ\", \"OP\": \"+\", \"DEP\": {\"IN\": [\"mark\"]}}, #conjunção com preposição\n","                {\"POS\": \"VERB\", \"OP\": \"+\", \"DEP\": {\"IN\": [\"xcomp\"]}}, #verbo normal como complementar\n","               ] \n","\n","#Somente verbos auxiliares\n","gramaticav3 =  [\n","                {\"POS\": \"AUX\", \"OP\": \"?\"},  #Verbos auxiliar \n","                {\"POS\": \"AUX\", \"OP\": \"?\", \"DEP\": {\"IN\": [\"cop\"]}},  #Verbos auxiliar de ligação (AUX+(cop))\n","                {\"POS\": \"ADJ\", \"OP\": \"+\", \"DEP\": {\"IN\": [\"ROOT\"]}}, \n","                {\"POS\": \"AUX\", \"OP\": \"?\"}  #Verbos auxiliar \n","               ] \n","\n","matcherv = Matcher(nlp.vocab)\n","         \n","matcherv.add(\"frase verbal\", [gramaticav1])\n","matcherv.add(\"frase verbal\", [gramaticav2])\n","matcherv.add(\"frase verbal\", [gramaticav3])\n","\n","#Retorna a Frase Verbal\n","def getVerbos(periodo):    \n","  #Processa o período\n","  doc1 = nlp(periodo.text)\n","  \n","  # Chama o mather para encontrar o padrão\n","  matches = matcherv(doc1)\n","\n","  padrao = [doc1[start:end] for _, start, end in matches]\n","\n","  #elimina as repetições e sobreposições\n","  #return filter_spans(padrao)\n","  lista1 = filter_spans(padrao)\n","\n","  # Converte os itens em string\n","  lista2 = []\n","  for x in lista1:\n","      lista2.append(str(x))\n","  \n","  return lista2"]},{"cell_type":"markdown","metadata":{"id":"6ZVwbmn3Nx2t"},"source":["### getDicPOSQtde\n","\n","Conta as POS Tagging de uma sentença"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"3j3VF4NOSPbq"},"outputs":[],"source":["def getDicPOSQtde(sentenca):\n","\n","    # Verifica se o sentenca não foi processado pelo spaCy  \n","  if type(sentenca) is not spacy.tokens.doc.Doc:\n","      # Realiza o parsing no spacy\n","      doc = nlp(sentenca)\n","  else:\n","      doc = sentenca\n","\n","  # Retorna inteiros que mapeiam para classes gramaticais\n","  conta_dicionarios = doc.count_by(spacy.attrs.IDS[\"POS\"])\n","\n","  # Dicionário com as tags e quantidades\n","  novodic = dict()\n","  \n","  for pos, qtde in conta_dicionarios.items():\n","    classe_gramatical = doc.vocab[pos].text\n","    novodic[classe_gramatical] = qtde\n","\n","  return novodic"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"0uPDYU4KBC5q"},"outputs":[],"source":["def getDicTodasPOSQtde(sentenca):\n","\n","    # Verifica se o sentenca não foi processado pelo spaCy  \n","  if type(sentenca) is not spacy.tokens.doc.Doc:\n","      # Realiza o parsing no spacy\n","      doc = nlp(sentenca)\n","  else:\n","      doc = sentenca\n","\n","  # Retorna inteiros que mapeiam para classes gramaticais\n","  conta_dicionarios = doc.count_by(spacy.attrs.IDS[\"POS\"])\n","\n","  # Dicionário com as tags e quantidades    \n","  novodic = {\"PRON\":0, \"VERB\":0, \"PUNCT\":0, \"DET\":0, \"NOUN\":0, \"AUX\":0, \"CCONJ\":0, \"ADP\":0, \"PROPN\":0, \"ADJ\":0, \"ADV\":0, \"NUM\":0, \"SCONJ\":0, \"SYM\":0, \"SPACE\":0, \"INTJ\":0, \"X\": 0}\n","    \n","  for pos, qtde in conta_dicionarios.items():\n","    classe_gramatical = doc.vocab[pos].text\n","    novodic[classe_gramatical] = qtde\n","\n","  return novodic"]},{"cell_type":"markdown","metadata":{"id":"Jxe-mh-l6sJY"},"source":["### getDicTodasPOSQtde\n","\n","Conta as POS Tagging de uma sentença"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"j9SA61kD6sJY"},"outputs":[],"source":["def getDicTodasPOSQtde(lista):\n","\n","  # Dicionário com as tags e quantidades\n","  conjunto = {\"PRON\":0, \"VERB\":0, \"PUNCT\":0, \"DET\":0, \"NOUN\":0, \"AUX\":0, \"CCONJ\":0, \"ADP\":0, \"PROPN\":0, \"ADJ\":0, \"ADV\":0, \"NUM\":0, \"SCONJ\":0, \"SYM\":0, \"SPACE\":0, \"INTJ\": 0}\n","\n","  for x in lista:\n","    valor = conjunto.get(x)\n","    if valor != None:\n","      conjunto[x] = valor + 1\n","    else:\n","      conjunto[x] = 1\n","\n","  return conjunto"]},{"cell_type":"markdown","metadata":{"id":"m4KV_jI-Nx2w"},"source":["### getSomaDic\n","\n","Soma os valores de dicionários com as mesmas chaves."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"mGduPM6HNx2w"},"outputs":[],"source":["from collections import Counter\n","from functools import reduce\n","\n","def atualizaValor(a,b):\n","    a.update(b)\n","    return a\n","\n","def getSomaDic(lista):\n","    \n","  # Soma os dicionários da lista\n","  novodic = reduce(atualizaValor, (Counter(dict(x)) for x in lista))\n"," \n","  return novodic"]},{"cell_type":"markdown","metadata":{"id":"bGaf7bkpAEiX"},"source":["### getTokensSentenca\n","\n","Retorna a lista de tokens da sentenca."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"gWxyAo54AOHU"},"outputs":[],"source":["def getTokensSentenca(sentenca):\n","\n","    # Verifica se o sentenca não foi processado pelo spaCy  \n","  if type(sentenca) is not spacy.tokens.doc.Doc:\n","      # Realiza o parsing no spacy\n","      doc = nlp(sentenca)\n","  else:\n","      doc = sentenca\n","\n","  # Lista dos tokens\n","  lista = []\n","\n","  # Percorre a sentença adicionando os tokens\n","  for token in doc:    \n","    lista.append(token.text)\n","\n","  return lista"]},{"cell_type":"markdown","metadata":{"id":"ZB6bR42PA28c"},"source":["### getPOSTokensSentenca\n","\n","Retorna a lista das POS-Tagging dos tokens da sentenca."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"awaqjNIZA3Fk"},"outputs":[],"source":["def getPOSTokensSentenca(sentenca):\n","\n","  # Verifica se o sentenca não foi processado pelo spaCy  \n","  if type(sentenca) is not spacy.tokens.doc.Doc:\n","      # Realiza o parsing no spacy\n","      doc = nlp(sentenca)\n","  else:\n","      doc = sentenca\n","\n","  # Lista dos tokens\n","  lista = []\n","\n","  # Percorre a sentença adicionando os tokens\n","  for token in doc:    \n","    lista.append(token.pos_)\n","\n","  return lista"]},{"cell_type":"markdown","metadata":{"id":"B4Soqt3fp3Lu"},"source":["### getListaTokensPOSSentenca\n","\n","Retorna duas listas uma com os tokens e a outra com a POS-Tagging dos tokens da sentenca."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Gvd99wd_pwmt"},"outputs":[],"source":["def getListaTokensPOSSentenca(sentenca):\n","  # Verifica se o sentenca não foi processado pelo spaCy  \n","  if type(sentenca) is not spacy.tokens.doc.Doc:\n","      # Realiza o parsing no spacy\n","      doc = nlp(sentenca)\n","  else:\n","      doc = sentenca\n","\n","  # Lista dos tokens\n","  lista_tokens = []\n","  lista_pos = []\n","\n","  # Percorre a sentença adicionando os tokens e as POS\n","  for token in doc:    \n","    lista_tokens.append(token.text)\n","    lista_pos.append(token.pos_)\n","    \n","  return lista_tokens, lista_pos"]},{"cell_type":"markdown","metadata":{"id":"ENvsIER06sJX"},"source":["### Tadução das tags"]},{"cell_type":"markdown","metadata":{"id":"kwSb3ECU6sJY"},"source":["Tags de palavras universal\n","\n","https://universaldependencies.org/u/pos/\n","\n","Detalhes das tags em português:\n","http://www.dbd.puc-rio.br/pergamum/tesesabertas/1412298_2016_completo.pdf"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"NpCUpOs06sJY"},"outputs":[],"source":["#dicionário que contêm pos tag universal e suas explicações\n","palavra_universal_dict = {\n","  \"X\"    : \"Outro\",\n","  \"VERB\" : \"Verbo \",\n","  \"SYM\"  : \"Símbolo\",\n","  \"CONJ\" : \"Conjunção\",\n","  \"SCONJ\": \"Conjunção subordinativa\",\n","  \"PUNCT\": \"Pontuação\",\n","  \"PROPN\": \"Nome próprio\",\n","  \"PRON\" : \"Pronome substativo\",\n","  \"PART\" : \"Partícula, morfemas livres\",\n","  \"NUM\"  : \"Numeral\",\n","  \"NOUN\" : \"Substantivo\",\n","  \"INTJ\" : \"Interjeição\",\n","  \"DET\"  : \"Determinante, Artigo e pronomes adjetivos\",\n","  \"CCONJ\": \"Conjunção coordenativa\",\n","  \"AUX\"  : \"Verbo auxiliar\",\n","  \"ADV\"  : \"Advérbio\",\n","  \"ADP\"  : \"Preposição\",\n","  \"ADJ\"  : \"Adjetivo\"\n","}\n","  \n","#Explica a POS\n","def getPOSPalavraUniversalTraduzido(palavra):\n","  if palavra in palavra_universal_dict.keys():\n","      traduzido = palavra_universal_dict[palavra]\n","  else:\n","      traduzido = \"NA\" \n","  return traduzido"]},{"cell_type":"markdown","metadata":{"id":"b01WgMSSKY_u"},"source":["### getSentencaSemStopWord\n","\n","Retorna uma lista dos tokens sem as stopwords."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"rMb0uDWzKZXP"},"outputs":[],"source":["def getSentencaSemStopWord(sentenca, stopwords):\n","\n","  # Lista dos tokens\n","  lista = []\n","\n","  # Percorre os tokens da sentença\n","  for i, token in enumerate(sentenca):\n","\n","    # Verifica se o token é uma stopword\n","    if token.lower() not in stopwords:\n","      lista.append(token)\n","\n","  # Retorna o documento\n","  return lista"]},{"cell_type":"markdown","metadata":{"id":"TouR4GjNJZD6"},"source":["### getSentencaSalientePOS\n","\n","Retorna uma lista das palavras do tipo especificado."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zxTCYFzcJZD6"},"outputs":[],"source":["def getSentencaSalientePOS(sentenca, pos, tipo_saliente=\"NOUN\"):\n","  \n","  # Lista dos tokens\n","  lista = []\n","\n","  # Percorre a sentença\n","  for i, token in enumerate(sentenca):\n","\n","    # Verifica se o token é do tipo especeficado\n","    if pos[i] == tipo_saliente:\n","      lista.append(token)\n","\n","  # Retorna o documento\n","  return lista"]},{"cell_type":"markdown","metadata":{"id":"_xaeX0oTVQ5t"},"source":["###removeStopWords\n","\n","Remove as stopwords de um documento ou senteça."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"NIaQ9bzBVQ5t"},"outputs":[],"source":["def removeStopWord(documento, stopwords):\n","  \n","  # Remoção das stopwords do documento\n","  documento_sem_stopwords = [palavra for palavra in documento.split() if palavra.lower() not in stopwords]\n","\n","  # Concatena o documento sem os stopwords\n","  documento_limpo = \" \".join(documento_sem_stopwords)\n","\n","  # Retorna o documento\n","  return documento_limpo"]},{"cell_type":"markdown","metadata":{"id":"A7NAe8ogCf1y"},"source":["### retornaRelevante\n","\n","Retorna somente os palavras do documento ou sentença do tipo especificado."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"UNNfykypChn-"},"outputs":[],"source":["def retornaRelevante(documento, classe_relevante=\"NOUN\"):\n","\n","  # Corrigir!\n","  # Utilizar o documento já tokenizado pelo spacy!!!!\n","  # Existe uma lista com o documento e a sentença tokenizada pelo spacy\n","  \n","  # Realiza o parsing no spacy\n","  doc = nlp(documento)\n","\n","  # Retorna a lista das palavras relevantes\n","  documento_com_substantivos = []\n","  for token in doc:\n","    #print(\"token:\", token.pos_)\n","    if token.pos_ == classe_relevante:\n","      documento_com_substantivos.append(token.text)\n","\n","  # Concatena o documento com os substantivos\n","  documento_concatenado = \" \".join(documento_com_substantivos)\n","\n","  # Retorna o documento\n","  return documento_concatenado"]},{"cell_type":"markdown","metadata":{"id":"IBY7q_uH8JSE"},"source":["# 4 BERT"]},{"cell_type":"markdown","metadata":{"id":"MBGTMy8Ic7GK"},"source":["## 4.1 Modelo Pré-treinado BERT"]},{"cell_type":"markdown","metadata":{"id":"uiuxdXe9t1BX"},"source":["### Funções Auxiliares"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"9Huw0x5kt1Le"},"outputs":[],"source":["def getNomeModeloBERT(model_args):\n","    '''    \n","    Recupera uma string com uma descrição do modelo BERT para nomes de arquivos e diretórios.\n","    \n","    Parâmetros:\n","    `model_args` - Objeto com os argumentos do modelo.       \n","    \n","    Retorno:\n","    `MODELO_BERT` - Nome do modelo BERT.\n","    '''\n","\n","    # Verifica o nome do modelo(default SEM_MODELO_BERT)\n","    MODELO_BERT = \"SEM_MODELO_BERT\"\n","    \n","    if 'neuralmind' in model_args.pretrained_model_name_or_path:\n","        MODELO_BERT = \"_BERTimbau\"\n","        \n","    else:\n","        if 'multilingual' in model_args.pretrained_model_name_or_path:\n","            MODELO_BERT = \"_BERTmultilingual\"\n","            \n","    return MODELO_BERT"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"jYJB4ik7t5xe"},"outputs":[],"source":["def getTamanhoBERT(model_args):\n","    '''    \n","    Recupera uma string com o tamanho(dimensão) do modelo BERT para nomes de arquivos e diretórios.\n","    \n","    Parâmetros:\n","    `model_args` - Objeto com os argumentos do modelo.       \n","    \n","    Retorno:\n","    `TAMANHO_BERT` - Nome do tamanho do modelo BERT.\n","    '''\n","    \n","    # Verifica o tamanho do modelo(default large)\n","    TAMANHO_BERT = \"_large\"\n","    \n","    if 'base' in model_args.pretrained_model_name_or_path:\n","        TAMANHO_BERT = \"_base\"\n","        \n","    return TAMANHO_BERT  "]},{"cell_type":"markdown","metadata":{"id":"rHt4e5pAcEMd"},"source":["### Função download Modelo Pre-treinado BERT"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"peDUrV2ccEXA"},"outputs":[],"source":["# Import das bibliotecas.\n","import zipfile # Biblioteca para descompactar\n","import shutil # iblioteca de manipulação arquivos de alto nível\n","\n","def downloadModeloPretreinado(model_args):\n","    \"\"\"\n","      Realiza o download do modelo BERT(MODELO) e retorna o diretório onde o modelo BERT(MODELO) foi descompactado.\n","    \n","      Parâmetros:\n","        `model_args` - Objeto com os argumentos do modelo.\n","    \n","      Retorno:\n","        `DIRETORIO_MODELO` - Diretório de download do modelo.\n","    \"\"\" \n","    \n","    # Nome diretório base modelo BERT\n","    NOME_DIRETORIO_BASE_MODELO = \"modeloBERT\"\n","    \n","    # Verifica se existe o diretório base do cohebert e retorna o nome do diretório\n","    DIRETORIO_DADOS_CLINICOS = verificaDiretorioCoheBERT()\n","    \n","    # Recupera o nome ou caminho do modelo\n","    MODELO = model_args.pretrained_model_name_or_path\n","\n","    # Variável para setar o arquivo.\n","    URL_MODELO = None\n","\n","    if \"http\" in MODELO:\n","        URL_MODELO = MODELO\n","\n","    # Se a variável foi setada.\n","    if URL_MODELO:\n","\n","        # Diretório do modelo.\n","        DIRETORIO_MODELO = DIRETORIO_DADOS_CLINICOS + \"/\" + NOME_DIRETORIO_BASE_MODELO\n","        \n","        # Recupera o nome do arquivo do modelo da url.\n","        NOME_ARQUIVO = URL_MODELO.split(\"/\")[-1]\n","\n","        # Nome do arquivo do vocabulário.\n","        ARQUIVO_VOCAB = \"vocab.txt\"\n","        \n","        # Caminho do arquivo na url.\n","        CAMINHO_ARQUIVO = URL_MODELO[0:len(URL_MODELO)-len(NOME_ARQUIVO)]\n","\n","        # Verifica se o diretório de descompactação existe no diretório corrente\n","        if os.path.exists(DIRETORIO_MODELO):\n","            logging.info(\"Apagando diretório existente do modelo!\")\n","            # Apaga o diretório e os arquivos existentes                     \n","            shutil.rmtree(DIRETORIO_MODELO)\n","        \n","        # Realiza o download do arquivo do modelo        \n","        downloadArquivo(URL_MODELO, NOME_ARQUIVO)\n","\n","        # Descompacta o arquivo no diretório de descompactação.                \n","        arquivo_zip = zipfile.ZipFile(NOME_ARQUIVO, \"r\")\n","        arquivo_zip.extractall(DIRETORIO_MODELO)\n","\n","        # Baixa o arquivo do vocabulário.\n","        # O vocabulário não está no arquivo compactado acima, mesma url mas arquivo diferente.\n","        URL_MODELO_VOCAB = CAMINHO_ARQUIVO + ARQUIVO_VOCAB\n","        # Coloca o arquivo do vocabulário no diretório do modelo.        \n","        downloadArquivo(URL_MODELO_VOCAB, DIRETORIO_MODELO + \"/\" + ARQUIVO_VOCAB)\n","        \n","        # Apaga o arquivo compactado\n","        os.remove(NOME_ARQUIVO)\n","\n","        logging.info(\"Diretório {} do modelo BERT pronta!\".format(DIRETORIO_MODELO))\n","\n","    else:\n","        DIRETORIO_MODELO = MODELO\n","        logging.info(\"Variável URL_MODELO não setada!\")\n","\n","    return DIRETORIO_MODELO"]},{"cell_type":"markdown","metadata":{"id":"V74WUpHqcfoI"},"source":["### Copia o modelo do BERT ajustado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"iQMpf9yycf8f"},"outputs":[],"source":["# Import das bibliotecas.\n","import shutil # iblioteca de manipulação arquivos de alto nível\n","\n","def copiaModeloAjustado(model_args):\n","    \"\"\" \n","      Copia o modelo ajustado BERT do GoogleDrive para o projeto.\n","    \n","      Parâmetros:\n","        `model_args` - Objeto com os argumentos do modelo.\n","    \n","      Retorno:\n","        `DIRETORIO_LOCAL_MODELO_AJUSTADO` - Diretório de download ajustado do modelo.\n","    \"\"\"\n","\n","    # Verifica o nome do modelo BERT a ser utilizado\n","    MODELO_BERT = getNomeModeloBERT(model_args)\n","\n","    # Verifica o tamanho do modelo(default large)\n","    TAMANHO_BERT = getTamanhoBERT(model_args)\n","\n","    # Verifica se existe o diretório base do cohebert e retorna o nome do diretório\n","    DIRETORIO_DADOS_CLINICOS = verificaDiretorioCoheBERT()\n","\n","    # Diretório local de salvamento do modelo.\n","    DIRETORIO_LOCAL_MODELO_AJUSTADO = DIRETORIO_DADOS_CLINICOS + \"/modelo_ajustado/\"\n","\n","    # Diretório remoto de salvamento do modelo no google drive.\n","    DIRETORIO_REMOTO_MODELO_AJUSTADO = \"/content/drive/MyDrive/Colab Notebooks/Data/\" + DIRETORIO_DADOS_CLINICOS + \"/validacao_classificacao_palavra/holdout/modelo/\" + MODELO_BERT + TAMANHO_BERT\n","\n","    # Copia o arquivo do modelo para o diretório no Google Drive.\n","    shutil.copytree(DIRETORIO_REMOTO_MODELO_AJUSTADO, DIRETORIO_LOCAL_MODELO_AJUSTADO) \n","   \n","    logging.info(\"Modelo BERT ajustado copiado!\")\n","\n","    return DIRETORIO_LOCAL_MODELO_AJUSTADO"]},{"cell_type":"markdown","metadata":{"id":"eaneOhAKcO-3"},"source":["### Verifica de onde utilizar o modelo do BERT"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"TTy1TXz3cPKS"},"outputs":[],"source":["def verificaModelo(model_args):\n","    \"\"\" \n","    Verifica de onde utilizar o modelo.\n","    \n","    Parâmetros:\n","    `model_args` - Objeto com os argumentos do modelo.\n","    \n","    Retorno:\n","    `DIRETORIO_MODELO` - Diretório de download do modelo.\n","    \"\"\" \n","\n","    DIRETORIO_MODELO = None\n","    \n","    if model_args.usar_mcl_ajustado == True:        \n","        # Diretório do modelo\n","        DIRETORIO_MODELO = copiaModeloAjustado()\n","        \n","        logging.info(\"Usando modelo BERT ajustado.\")\n","        \n","    else:\n","        DIRETORIO_MODELO = downloadModeloPretreinado(model_args)\n","        logging.info(\"Usando modelo BERT pré-treinado.\")        \n","        \n","    return DIRETORIO_MODELO"]},{"cell_type":"markdown","metadata":{"id":"6tKcaIfReqdy"},"source":["## 4.2 Tokenizador BERT"]},{"cell_type":"markdown","metadata":{"id":"e8n7Z5s-QZF8"},"source":["### Função carrega Tokenizador BERT\n","\n","O tokenizador utiliza WordPiece, veja em [artigo original](https://arxiv.org/pdf/1609.08144.pdf).\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"mzAuptkwQZR3"},"outputs":[],"source":["# Import das bibliotecas.\n","from transformers import BertTokenizer # Importando as bibliotecas do tokenizador BERT.\n","\n","def carregaTokenizadorModeloPretreinado(DIRETORIO_MODELO, model_args):\n","    \"\"\"\n","      Carrega o tokenizador do DIRETORIO_MODELO.\n","      O tokenizador utiliza WordPiece.\n","      Carregando o tokenizador do diretório \"./modelo/\" do diretório padrão se variável `DIRETORIO_MODELO` setada.\n","      Caso contrário carrega da comunidade\n","      Por default(`do_lower_case=True`) todas as letras são colocadas para minúsculas. Para ignorar a conversão para minúsculo use o parâmetro `do_lower_case=False`. Esta opção também considera as letras acentuadas(ãçéí...), que são necessárias a língua portuguesa.\n","      O parâmetro `do_lower_case` interfere na quantidade tokens a ser gerado a partir de um texto. Quando igual a `False` reduz a quantidade de tokens gerados.\n","    \n","      Parâmetros:\n","        `DIRETORIO_MODELO` - Diretório a ser utilizado pelo modelo BERT.           \n","        `model_args` - Objeto com os argumentos do modelo.       \n","    \n","      Retorno:\n","        `tokenizer` - Tokenizador BERT.\n","    \"\"\"\n","\n","    tokenizer = None\n","    \n","    # Se a variável DIRETORIO_MODELO foi setada.\n","    if DIRETORIO_MODELO:\n","        # Carregando o Tokenizador.\n","        logging.info(\"Carregando o tokenizador BERT do diretório {}.\".format(DIRETORIO_MODELO))\n","\n","        tokenizer = BertTokenizer.from_pretrained(DIRETORIO_MODELO, do_lower_case=model_args.do_lower_case)\n","\n","    else:\n","        # Carregando o Tokenizador da comunidade.\n","        logging.info(\"Carregando o tokenizador BERT da comunidade.\")\n","\n","        tokenizer = BertTokenizer.from_pretrained(model_args.pretrained_model_name_or_path, do_lower_case=model_args.do_lower_case)\n","\n","    return tokenizer"]},{"cell_type":"markdown","metadata":{"id":"GYRV9KfHQE6v"},"source":["## 4.3 Carrega o modelo e tokenizador BERT\n","\n","Lista de modelos da comunidade:\n","* https://huggingface.co/models\n","\n","Português(https://github.com/neuralmind-ai/portuguese-bert):  \n","* **\"neuralmind/bert-base-portuguese-cased\"**\n","* **\"neuralmind/bert-large-portuguese-cased\"**"]},{"cell_type":"markdown","metadata":{"id":"-pZZrUKRhR3e"},"source":["### Função carrega modelo BERT medida\n","\n","A implementação do huggingface pytorch inclui um conjunto de interfaces projetadas para uma variedade de tarefas de PNL. Embora essas interfaces sejam todas construídas sobre um modelo treinado de BERT, cada uma possui diferentes camadas superiores e tipos de saída projetados para acomodar suas tarefas específicas de PNL.\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"1JUEyjCChUQh"},"outputs":[],"source":["# Import das bibliotecas.\n","from transformers import BertModel # Importando as bibliotecas do Modelo BERT.\n","\n","def carregaModeloMedida(DIRETORIO_MODELO, model_args):\n","    \"\"\"\n","      Carrega o modelo e retorna o modelo.\n","    \n","      Parâmetros:\n","        `DIRETORIO_MODELO` - Diretório a ser utilizado pelo modelo BERT.           \n","        `model_args` - Objeto com os argumentos do modelo.   \n","    \n","      Retorno:\n","        `model` - Um objeto do modelo BERT carregado.\n","    \"\"\"\n","\n","    # Variável para setar o arquivo.\n","    URL_MODELO = None\n","\n","    if \"http\" in model_args.pretrained_model_name_or_path:\n","        URL_MODELO = model_args.pretrained_model_name_or_path\n","\n","    # Se a variável URL_MODELO foi setada\n","    if URL_MODELO:        \n","        # Carregando o Modelo BERT\n","        logging.info(\"Carregando o modelo BERT do diretório {} para cálculo de medidas.\".format(DIRETORIO_MODELO))\n","\n","        model = BertModel.from_pretrained(DIRETORIO_MODELO,\n","                                          output_attentions=model_args.output_attentions,\n","                                          output_hidden_states=model_args.output_hidden_states)\n","        \n","    else:\n","        # Carregando o Modelo BERT da comunidade\n","        logging.info(\"Carregando o modelo BERT da comunidade {} para cálculo de medidas.\".format(model_args.pretrained_model_name_or_path))\n","\n","        model = BertModel.from_pretrained(model_args.pretrained_model_name_or_path,\n","                                          output_attentions=model_args.output_attentions,\n","                                          output_hidden_states=model_args.output_hidden_states)\n","\n","    return model"]},{"cell_type":"markdown","metadata":{"id":"-uFDhRTZe2Js"},"source":["### Função carrega o BERT"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"QVtAUbUBe2iS"},"outputs":[],"source":["def carregaBERT(model_args):\n","    \"\"\" \n","      Carrega o BERT para cálculo de medida ou classificação e retorna o modelo e o tokenizador.\n","      O tipo do model retornado pode ser BertModel ou BertForSequenceClassification, depende do tipo de model_args.\n","    \n","      Parâmetros:\n","        `model_args` - Objeto com os argumentos do modelo.       \n","          - Se model_args = ModeloArgumentosClassificacao deve ser carregado o BERT para classificação(BertForSequenceClassification).\n","          - Se model_args = ModeloArgumentosMedida deve ser carregado o BERT para cálculo de medida(BertModel).\n","\n","      Retorno:    \n","        `model` - Um objeto do modelo BERT carregado.       \n","        `tokenizer` - Um objeto tokenizador BERT carregado.       \n","    \"\"\"\n","            \n","    # Verifica a origem do modelo\n","    DIRETORIO_MODELO = verificaModelo(model_args)\n","    \n","    # Variável para conter o modelo\n","    model = None\n","    \n","    # Carrega o modelo para cálculo da medida\n","    model = carregaModeloMedida(DIRETORIO_MODELO, model_args)\n","                \n","    # Carrega o tokenizador. \n","    # O tokenizador é o mesmo para o classificador e medidor.\n","    tokenizer = carregaTokenizadorModeloPretreinado(DIRETORIO_MODELO, model_args)\n","    \n","    return model, tokenizer"]},{"cell_type":"markdown","metadata":{"id":"x5NTxBRKfAcT"},"source":["### Carrega o BERT"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":283,"referenced_widgets":["2b979a433f5f49938aaf7e258c66303e","004a1427cceb4ee8ad5f6fa302801909","32785ee343b94c99b6e4be5d3af1a2bb","e33f9a34b050486398fe400c1afdae01","ab74ff9e90334ed8964f04913a8ea009","4182d87f3d03406480c09e4089521018","684dbbf334c04970b27575dadaf1d750","e01f52a9da964f7db763da8c536b55c0","58f6431181974080983170c0ce2ba1de","9954d08b8d2f44189c155f6b6f7dedd1","f3024a9af517450992f03911274bc434","8b554757975547d489e1525261f9ca19","1827198a686a498a9b076c3a7768bc87","eb077a63eb764a8984581b1c309ff69c","ba1d0fbc835a4dd1a7b8e45c0e07a952","fa79fca08ed048498308eaf6535f4e31","a7e9d1e38e54460d887520f86e0251ea","2af2461f1676494cac53346e941f8871","39ea44f31baa448ca313fef525595fbf","f1eb4f59df4f46b9a5bb3f4315546967","729c916fc5d943d387616bf182eb67d7","f3c5b2ec2f4d4505ad66b214f6ee002d","1bf025459b4041b69b812b737f65eb99","e0a82ba5aa4f4feb8b244367293cf1f5","de2dbeda7ec24a618a8a223bff8d439f","e17195dc57c241ee85dab7501b4ac708","ebf06da1539c44bc950a89f672f9f9d5","1a62f2db617448e6b16cb17821f51fba","0f09ac35ac464a82b543e1a8569cee7b","7f56a660fe1a45ce9cbdbb17c7d3f6f3","3730b067e9ab4c36b7b3a1ab492ccc64","74ffdf9a54e74bf3bad8a37f82f287a5","28c0c75fb4c94bf4b3b8850f5c1a6798","2466d2a6bc244d6f91483ca3525d4725","688e568a85f345e6bca01cca417b2be6","173151d74d43455db61325c4048949e5","8e03e93ddd8f44c197c807e3fd4e6061","5a6388c435d845e6a791e0e49d3f2233","172119c99ceb418e95c725bf9b3b134b","aa7337611a204007a4939ce2ff845aac","c3ac523c875f4a5188bc9dcb1aa0891a","7f85e20e8d1f405cb8f028712e4a4034","c0dcf6400f4d4572bb0846d86ea85add","b0aec44c7f6643bea5455ae86e839ba7","1b91feea2b9b4508b181a9aa34512897","cb45900d2ed74920b05c65b749d9dd23","ba19c059456c417d948a95a8704c42f8","2bc21b015ba14f7ca0a4efa10bcc4ae6","07b20c22272146c09e5d724fbde226da","25fcd7f4c299465db83481c11fdf4276","0653908463664c84a02f2920399fe6a4","b3de34c905ce4406b19af9772b028a57","9960d7e850394a92affee1f7debdbc92","63f38f30513944c792f07e4434bd797d","bb73149b473446bebd649457335d14cc","87c39e51ab5046c4b88d7bccb9cc745a","b0b275c579024ed4bdad8388417851ab","ac3143e2717b45ca9f58102a1cc7f8e6","ae720d154701455a85ce1d5c7a2c31b1","a472850d481240a286cdaa74f2b44881","d46ca0dfbfef4fb187c9f27166297336","9c3b99a610f0433d9ec5e84babbe555b","87fa56e0b40d4dbda3cee1cebf5c92ed","f3d06a93e645486186105154245f3f0d","f08d67e402db477a922d686b0a4200d4","09d95a0ffa934d7982d1ef813bc10d68"]},"executionInfo":{"elapsed":32926,"status":"ok","timestamp":1670461783170,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"ZYMLJJYSQHY3","outputId":"e302ceb2-2bc5-4830-ed24-a9390ffbe7fb"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Variável URL_MODELO não setada!\n","INFO:root:Usando modelo BERT pré-treinado.\n","INFO:root:Carregando o modelo BERT da comunidade neuralmind/bert-large-portuguese-cased para cálculo de medidas.\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"2b979a433f5f49938aaf7e258c66303e","version_major":2,"version_minor":0},"text/plain":["Downloading:   0%|          | 0.00/648 [00:00<?, ?B/s]"]},"metadata":{},"output_type":"display_data"},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"8b554757975547d489e1525261f9ca19","version_major":2,"version_minor":0},"text/plain":["Downloading:   0%|          | 0.00/1.34G [00:00<?, ?B/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stderr","output_type":"stream","text":["INFO:root:Carregando o tokenizador BERT do diretório neuralmind/bert-large-portuguese-cased.\n"]},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"1bf025459b4041b69b812b737f65eb99","version_major":2,"version_minor":0},"text/plain":["Downloading:   0%|          | 0.00/210k [00:00<?, ?B/s]"]},"metadata":{},"output_type":"display_data"},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"2466d2a6bc244d6f91483ca3525d4725","version_major":2,"version_minor":0},"text/plain":["Downloading:   0%|          | 0.00/2.00 [00:00<?, ?B/s]"]},"metadata":{},"output_type":"display_data"},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"1b91feea2b9b4508b181a9aa34512897","version_major":2,"version_minor":0},"text/plain":["Downloading:   0%|          | 0.00/112 [00:00<?, ?B/s]"]},"metadata":{},"output_type":"display_data"},{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"87c39e51ab5046c4b88d7bccb9cc745a","version_major":2,"version_minor":0},"text/plain":["Downloading:   0%|          | 0.00/155 [00:00<?, ?B/s]"]},"metadata":{},"output_type":"display_data"}],"source":["# Carrega o modelo e tokenizador do BERT\n","model, tokenizer = carregaBERT(model_args)"]},{"cell_type":"markdown","metadata":{"id":"d7KprWqyZBQZ"},"source":["### Recupera detalhes do BERT"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"D6sPjTQnuQV2"},"outputs":[],"source":["# Verifica o nome do modelo BERT a ser utilizado\n","MODELO_BERT = getNomeModeloBERT(model_args)\n","\n","# Verifica o tamanho do modelo(default large)\n","TAMANHO_BERT = getTamanhoBERT(model_args)"]},{"cell_type":"markdown","metadata":{"id":"khTFfBVbnsx9"},"source":["## 4.4 Funções auxiliares do BERT"]},{"cell_type":"markdown","metadata":{"id":"lCJzsw8T0I-5"},"source":["### concatenaListas"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"IpmDZ1mI0JHR"},"outputs":[],"source":["def concatenaListas(lista, pos=1):\n","  lista_concat = []\n","\n","  for x in lista:\n","      lista_concat = lista_concat + x[pos]\n","  \n","  return lista_concat"]},{"cell_type":"markdown","metadata":{"id":"s42mgtmSZ8MR"},"source":["### getEmbeddingsCamadas\n","\n","Funções que recuperam os embeddings das camadas:\n","- Primeira camada;\n","- Penúltima camada;\n","- Ùltima camada;\n","- Soma das 4 últimas camadas;\n","- Concatenação das 4 últimas camadas;\n","- Soma de todas as camadas."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"sgo3EBTRZ9-3"},"outputs":[],"source":["def getEmbeddingPrimeiraCamada(output):\n","  # outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","  # hidden_states é uma lista python, e cada elemento um tensor pytorch no formado <lote> x <qtde_tokens> x <768 ou 1024>.\n","      \n","  # Retorna todas a primeira(-1) camada\n","  # Entrada: List das camadas(13 ou 25) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  resultado = output[2][0]\n","  # Saída: (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  \n","  return resultado\n","\n","def getEmbeddingPenultimaCamada(output):\n","  # outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","  # hidden_states é uma lista python, e cada elemento um tensor pytorch no formado <lote> x <qtde_tokens> x <768 ou 1024>.\n","      \n","  # Retorna todas a primeira(-1) camada\n","  # Entrada: List das camadas(13 ou 25) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  resultado = output[2][-2]\n","  # Saída: (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  \n","  return resultado\n","\n","def getEmbeddingUltimaCamada(output):\n","  # outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","  # hidden_states é uma lista python, e cada elemento um tensor pytorch no formado <lote> x <qtde_tokens> x <768 ou 1024>.\n","     \n","  # Retorna todas a primeira(-1) camada\n","  # Entrada: List das camadas(13 ou 25) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  resultado = output[2][-1]\n","  # Saída: (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  \n","  return resultado    \n","\n","def getEmbeddingSoma4UltimasCamadas(output):\n","  # outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","  # hidden_states é uma lista python, e cada elemento um tensor pytorch no formado <lote> x <qtde_tokens> x <768 ou 1024>.\n","      \n","  # Retorna todas a primeira(-1) camada\n","  # Entrada: List das camadas(13 ou 25) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  embedding_camadas = output[2][-4:]\n","  # Saída: List das camadas(4) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","\n","  # Usa o método `stack` para criar uma nova dimensão no tensor \n","  # com a concateção dos tensores dos embeddings.        \n","  #Entrada: List das camadas(4) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  resultado_stack = torch.stack(embedding_camadas, dim=0)\n","  # Saída: <4> x <1(lote)> x <qtde_tokens> x <768 ou 1024>\n","  \n","  # Realiza a soma dos embeddings de todos os tokens para as camadas\n","  # Entrada: <4> x <1(lote)> x <qtde_tokens> x <768 ou 1024>\n","  resultado = torch.sum(resultado_stack, dim=0)\n","  # Saida: <1(lote)> x <qtde_tokens> x <768 ou 1024>\n","  \n","  return resultado\n","\n","def getEmbeddingConcat4UltimasCamadas(output):  \n","  # outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","  # hidden_states é uma lista python, e cada elemento um tensor pytorch no formado <lote> x <qtde_tokens> x <768 ou 1024>.\n","      \n","  # Cria uma lista com os tensores a serem concatenados\n","  # Entrada: List das camadas(13 ou 25) (<1(lote)> x <qtde_tokens> x <768 ou 1024>)  \n","  # Lista com os tensores a serem concatenados  \n","  lista_concat = []\n","\n","  # Percorre os 4 últimos\n","  for i in [-1,-2,-3,-4]:\n","      # Concatena da lista\n","      lista_concat.append(output[2][i])\n","\n","  # Saída: Entrada: List das camadas(4) (<1(lote)> x <qtde_tokens> x <768 ou 1024>)    \n","  # Realiza a concatenação dos embeddings de todos as camadas\n","  # Saída: Entrada: List das camadas(4) (<1(lote)> x <qtde_tokens> x <768 ou 1024>)  \n","  resultado = torch.cat(lista_concat, dim=-1)\n","  \n","  # Saída: Entrada: (<1(lote)> x <qtde_tokens> x <3072 ou 4096>)    \n","  return resultado   \n","\n","def getEmbeddingSomaTodasAsCamada(output):\n","  # outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","  # hidden_states é uma lista python, e cada elemento um tensor pytorch no formado <lote> x <qtde_tokens> x <768 ou 1024>.\n","   \n","  # Retorna todas as camadas descontando a primeira(0)\n","  # Entrada: List das camadas(13 ou 25) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  embedding_camadas = output[2][1:]\n","  # Saída: List das camadas(12 ou 24) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  \n","  # Usa o método `stack` para criar uma nova dimensão no tensor \n","  # com a concateção dos tensores dos embeddings.        \n","  #Entrada: List das camadas(12 ou 24) (<1(lote)> x <qtde_tokens> <768 ou 1024>)  \n","  resultado_stack = torch.stack(embedding_camadas, dim=0)\n","  # Saída: <12 ou 24> x <1(lote)> x <qtde_tokens> x <768 ou 1024>\n","    \n","  # Realiza a soma dos embeddings de todos os tokens para as camadas\n","  # Entrada: <12 ou 24> x <1(lote)> x <qtde_tokens> x <768 ou 1024>\n","  resultado = torch.sum(resultado_stack, dim=0)\n","  # Saida: <1(lote)> x <qtde_tokens> x <768 ou 1024>\n","    \n","  return resultado"]},{"cell_type":"markdown","metadata":{"id":"q7nx_eZ8hSlr"},"source":["### getEmbeddingsVisual\n","\n","Função para gerar as coordenadas de plotagem a partir das sentenças de embeddings.\n","\n","Existe uma função para os tipos de camadas utilizadas:\n","- Ùltima camada;\n","- Soma das 4 últimas camadas;\n","- Concatenação das 4 últimas camadas;\n","- Soma de todas as camadas."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"pLdbOT8-g43V"},"outputs":[],"source":["def getEmbeddingsVisualUltimaCamada(documento, modelo, tokenizer):\n","    \n","    # Adiciona os tokens especiais\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Divide a sentença em tokens\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    # Mapeia as strings dos tokens em seus índices do vocabuário    \n","    tokens_indexados = tokenizer.convert_tokens_to_ids(documento_tokenizado)\n","    \n","    # Marca cada um dos tokens como pertencentes à sentença \"1\".\n","    mascara_atencao = [1] * len(documento_tokenizado)\n","\n","    # Converte a entrada em tensores\n","    tokens_tensores = torch.as_tensor([tokens_indexados])\n","    mascara_atencao_tensores = torch.as_tensor([mascara_atencao])\n","    \n","    # Prediz os atributos dos estados ocultos para cada camada\n","    with torch.no_grad():        \n","        # Retorno de model quando ´output_hidden_states=True´ é setado:  \n","        #outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","        outputs = modelo(tokens_tensores, mascara_atencao_tensores)\n","\n","    # Camada embedding    \n","    camada = getEmbeddingUltimaCamada(outputs)\n","\n","    # Remove a dimensão 1, o lote \"batches\".\n","    token_embeddings = torch.squeeze(camada, dim=0)\n","\n","    # Recupera os embeddings dos tokens como um vetor\n","    embeddings = token_embeddings.numpy()\n","\n","    # Converte para um array\n","    W = np.array(embeddings)\n","    # Transforma em um array\n","    B = np.array([embeddings[0], embeddings[-1]])\n","    # Invertee B.T\n","    Bi = np.linalg.pinv(B.T)\n","\n","    #Projeta a palavra no espaço\n","    Wp = np.matmul(Bi,W.T)\n","\n","    return Wp, documento_tokenizado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"eAf9lJJ2hZbt"},"outputs":[],"source":["def getEmbeddingsVisualSoma4UltimasCamadas(documento, modelo, tokenizer):\n","    \n","    # Adiciona os tokens especiais\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Divide a sentença em tokens\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    # Mapeia as strings dos tokens em seus índices do vocabuário    \n","    tokens_indexados = tokenizer.convert_tokens_to_ids(documento_tokenizado)\n","    \n","    # Marca cada um dos tokens como pertencentes à sentença \"1\".\n","    mascara_atencao = [1] * len(documento_tokenizado)\n","\n","    # Converte a entrada em tensores\n","    tokens_tensores = torch.as_tensor([tokens_indexados])\n","    mascara_atencao_tensores = torch.as_tensor([mascara_atencao])\n","    \n","    # Prediz os atributos dos estados ocultos para cada camada\n","    with torch.no_grad():        \n","        # Retorno de model quando ´output_hidden_states=True´ é setado:  \n","        #outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","        outputs = modelo(tokens_tensores, mascara_atencao_tensores)\n","\n","    # Camada embedding    \n","    camada = getEmbeddingSoma4UltimasCamadas(outputs)\n","\n","    # Remove a dimensão 1, o lote \"batches\".\n","    token_embeddings = torch.squeeze(camada, dim=0)\n","\n","    # Recupera os embeddings dos tokens como um vetor\n","    embeddings = token_embeddings.numpy()\n","\n","    # Converte para um array\n","    W = np.array(embeddings)\n","    # Transforma em um array\n","    B = np.array([embeddings[0], embeddings[-1]])\n","    # Invertee B.T\n","    Bi = np.linalg.pinv(B.T)\n","\n","    #Projeta a palavra no espaço\n","    Wp = np.matmul(Bi,W.T)\n","\n","    return Wp, documento_tokenizado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"4XpwSN1ghpnz"},"outputs":[],"source":["def getEmbeddingsVisualConcat4UltimasCamadas(documento, modelo, tokenizer):\n","    \n","    # Adiciona os tokens especiais\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Divide a sentença em tokens\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    # Mapeia as strings dos tokens em seus índices do vocabuário    \n","    tokens_indexados = tokenizer.convert_tokens_to_ids(documento_tokenizado)\n","    \n","    # Marca cada um dos tokens como pertencentes à sentença \"1\".\n","    mascara_atencao = [1] * len(documento_tokenizado)\n","\n","    # Converte a entrada em tensores\n","    tokens_tensores = torch.as_tensor([tokens_indexados])\n","    mascara_atencao_tensores = torch.as_tensor([mascara_atencao])\n","    \n","    # Prediz os atributos dos estados ocultos para cada camada\n","    with torch.no_grad():        \n","        # Retorno de model quando ´output_hidden_states=True´ é setado:  \n","        #outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","        outputs = modelo(tokens_tensores, mascara_atencao_tensores)\n","\n","    # Camada embedding        \n","    camada = getEmbeddingConcat4UltimasCamadas(outputs)\n","\n","    # Remove a dimensão 1, o lote \"batches\".\n","    token_embeddings = torch.squeeze(camada, dim=0)\n","\n","    # Recupera os embeddings dos tokens como um vetor\n","    embeddings = token_embeddings.numpy()\n","\n","    # Converte para um array\n","    W = np.array(embeddings)\n","    # Transforma em um array\n","    B = np.array([embeddings[0], embeddings[-1]])\n","    # Invertee B.T\n","    Bi = np.linalg.pinv(B.T)\n","\n","    #Projeta a palavra no espaço\n","    Wp = np.matmul(Bi,W.T)\n","\n","    return Wp, documento_tokenizado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"L3KU1EFrnSPK"},"outputs":[],"source":["def getEmbeddingsVisualSomaTodasAsCamadas(documento, modelo, tokenizer):\n","    \n","    # Adiciona os tokens especiais\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Divide a sentença em tokens\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    # Mapeia as strings dos tokens em seus índices do vocabuário    \n","    tokens_indexados = tokenizer.convert_tokens_to_ids(documento_tokenizado)\n","    \n","    # Marca cada um dos tokens como pertencentes à sentença \"1\".\n","    mascara_atencao = [1] * len(documento_tokenizado)\n","\n","    # Converte a entrada em tensores\n","    tokens_tensores = torch.as_tensor([tokens_indexados])\n","    mascara_atencao_tensores = torch.as_tensor([mascara_atencao])\n","    \n","    # Prediz os atributos dos estados ocultos para cada camada\n","    with torch.no_grad():        \n","        # Retorno de model quando ´output_hidden_states=True´ é setado:  \n","        #outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","        outputs = modelo(tokens_tensores, mascara_atencao_tensores)\n","\n","    # Camada embedding    \n","    camada = getEmbeddingSomaTodasAsCamada(outputs)\n","\n","    # Remove a dimensão 1, o lote \"batches\".\n","    token_embeddings = torch.squeeze(camada, dim=0)\n","\n","    # Recupera os embeddings dos tokens como um vetor\n","    embeddings = token_embeddings.numpy()\n","\n","    # Converte para um array\n","    W = np.array(embeddings)\n","    # Transforma em um array\n","    B = np.array([embeddings[0], embeddings[-1]])\n","    # Invertee B.T\n","    Bi = np.linalg.pinv(B.T)\n","\n","    #Projeta a palavra no espaço\n","    Wp = np.matmul(Bi,W.T)\n","\n","    return Wp, documento_tokenizado"]},{"cell_type":"markdown","metadata":{"id":"Y8MjE0utzlZT"},"source":["### getEmbeddings\n","\n","Função para gerar os embeddings de sentenças.\n","\n","Existe uma função para os tipos de camadas utilizadas:\n","- Ùltima camada;\n","- Soma das 4 últimas camadas;\n","- Concatenação das 4 últimas camadas;\n","- Soma de todas as camadas."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"2QcqOuwS067Q"},"outputs":[],"source":["def getEmbeddingsUltimaCamada(documento, modelo, tokenizer):\n","    \n","    # Adiciona os tokens especiais\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Divide a sentença em tokens\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    # Mapeia as strings dos tokens em seus índices do vocabuário    \n","    tokens_indexados = tokenizer.convert_tokens_to_ids(documento_tokenizado)\n","    \n","    # Marca cada um dos tokens como pertencentes à sentença \"1\".\n","    mascara_atencao = [1] * len(documento_tokenizado)\n","\n","    # Converte a entrada em tensores\n","    tokens_tensores = torch.as_tensor([tokens_indexados])\n","    mascara_atencao_tensores = torch.as_tensor([mascara_atencao])\n","    \n","    # Prediz os atributos dos estados ocultos para cada camada\n","    with torch.no_grad():        \n","        # Retorno de model quando ´output_hidden_states=True´ é setado:  \n","        #outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","        outputs = modelo(tokens_tensores, mascara_atencao_tensores)\n","\n","    # Camada embedding    \n","    camada = getEmbeddingUltimaCamada(outputs)\n","\n","    # Remove a dimensão 1, o lote \"batches\".\n","    token_embeddings = torch.squeeze(camada, dim=0)\n"," \n","    return token_embeddings, documento_tokenizado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BK1wDGBl067Y"},"outputs":[],"source":["def getEmbeddingsSoma4UltimasCamadas(documento, modelo, tokenizer):\n","    \n","    # Adiciona os tokens especiais\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Divide a sentença em tokens\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    # Mapeia as strings dos tokens em seus índices do vocabuário    \n","    tokens_indexados = tokenizer.convert_tokens_to_ids(documento_tokenizado)\n","    \n","    # Marca cada um dos tokens como pertencentes à sentença \"1\".\n","    mascara_atencao = [1] * len(documento_tokenizado)\n","\n","    # Converte a entrada em tensores\n","    tokens_tensores = torch.as_tensor([tokens_indexados])\n","    mascara_atencao_tensores = torch.as_tensor([mascara_atencao])\n","    \n","    # Prediz os atributos dos estados ocultos para cada camada\n","    with torch.no_grad():        \n","        # Retorno de model quando ´output_hidden_states=True´ é setado:  \n","        #outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","        outputs = modelo(tokens_tensores, mascara_atencao_tensores)\n","\n","    # Camada embedding    \n","    camada = getEmbeddingSoma4UltimasCamadas(outputs)\n","\n","    # Remove a dimensão 1, o lote \"batches\".\n","    token_embeddings = torch.squeeze(camada, dim=0)\n","   \n","    return token_embeddings, documento_tokenizado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Hym19Hxr067Y"},"outputs":[],"source":["def getEmbeddingsConcat4UltimasCamadas(documento, modelo, tokenizer):\n","    # Adiciona os tokens especiais\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Divide a sentença em tokens\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    # Mapeia as strings dos tokens em seus índices do vocabuário    \n","    tokens_indexados = tokenizer.convert_tokens_to_ids(documento_tokenizado)\n","\n","    # Marca cada um dos tokens como pertencentes à sentença \"1\".\n","    mascara_atencao = [1] * len(documento_tokenizado)\n","    \n","    # Converte a entrada em tensores\n","    tokens_tensores = torch.as_tensor([tokens_indexados])\n","    mascara_atencao_tensores = torch.as_tensor([mascara_atencao])\n","\n","    # Prediz os atributos dos estados ocultos para cada camada\n","    with torch.no_grad():        \n","        # Retorno de model quando ´output_hidden_states=True´ é setado:  \n","        #outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","        outputs = modelo(tokens_tensores, mascara_atencao_tensores)\n","\n","    # Camada embedding    \n","    camada = getEmbeddingConcat4UltimasCamadas(outputs)\n","\n","    # Remove a dimensão 1, o lote \"batches\".\n","    token_embeddings = torch.squeeze(camada, dim=0)\n","\n","    return token_embeddings, documento_tokenizado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"U-PLZiUR067Z"},"outputs":[],"source":["def getEmbeddingsSomaTodasAsCamadas(documento, modelo, tokenizer):\n","    \n","    # Adiciona os tokens especiais\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Divide a sentença em tokens\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    # Mapeia as strings dos tokens em seus índices do vocabuário    \n","    tokens_indexados = tokenizer.convert_tokens_to_ids(documento_tokenizado)\n","    \n","    # Marca cada um dos tokens como pertencentes à sentença \"1\".\n","    mascara_atencao = [1] * len(documento_tokenizado)\n","\n","    # Converte a entrada em tensores\n","    tokens_tensores = torch.as_tensor([tokens_indexados])\n","    mascara_atencao_tensores = torch.as_tensor([mascara_atencao])\n","    \n","    # Prediz os atributos dos estados ocultos para cada camada\n","    with torch.no_grad():        \n","        # Retorno de model quando ´output_hidden_states=True´ é setado:  \n","        #outputs[0] = last_hidden_state, outputs[1] = pooler_output, outputs[2] = hidden_states\n","        outputs = modelo(tokens_tensores, mascara_atencao_tensores)\n","\n","    # Camada embedding    \n","    camada = getEmbeddingSomaTodasAsCamada(outputs)\n","\n","    # Remove a dimensão 1, o lote \"batches\".\n","    token_embeddings = torch.squeeze(camada, dim=0)\n","\n","    return token_embeddings, documento_tokenizado"]},{"cell_type":"markdown","metadata":{"id":"Pyra3_pECsoJ"},"source":["### getEmbeddingsDocumento\n","\n","Recupara os embeddings e tokens do documento sem buffer."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"XdDBSRDcCxHp"},"outputs":[],"source":["def getEmbeddingsDocumento(documento, modelo, tokenizer):\n","\n","    return getEmbeddingsUltimaCamada(documento, modelo, tokenizer)\n","    # return getEmbeddingsConcat4UltimasCamadas(documento, modelo, tokenizer)\n","    # return getEmbeddingsConcat4UltimasCamadas(documento, modelo, tokenizer)"]},{"cell_type":"markdown","metadata":{"id":"-rLcMuDHC-F5"},"source":["### getEmbeddingsDocumentoBuffer\n","\n","Recupara os embeddings e tokens do documento com buffer."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"OogUm0kuC7wK"},"outputs":[],"source":["buffer_token_embeddings = {}\n","\n","def getEmbeddingsDocumentoBuffer(documento, modelo, tokenizer):\n","\n","    # Se documento está no dicionário retorna o embedding e os tokens\n","    if documento in buffer_token_embeddings:\n","        registro_buffer = buffer_token_embeddings.get(documento)\n","        return registro_buffer[0], registro_buffer[1]\n","    else:\n","        # Gera o embedding\n","        token_embeddings, documento_tokenizado = getEmbeddingsDocumento(documento, modelo, tokenizer)        \n","        buffer_token_embeddings.update({documento: [token_embeddings, documento_tokenizado]})\n","\n","        return  token_embeddings, documento_tokenizado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"iTRcghhuet76"},"outputs":[],"source":["def limpaBufferEmbedding():\n","    buffer_token_embeddings.clear()"]},{"cell_type":"markdown","metadata":{"id":"zFd1rse11DpZ"},"source":["### getDocumentoTokenizado \n","\n","Retorna o documento tokenizado"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"gvWIBFTLJ7z9"},"outputs":[],"source":["def getDocumentoTokenizado(documento, tokenizer):\n","    \"\"\"\n","      Retorna o documento tokenizado pelo BERT.\n","    \n","      Parâmetros:\n","      `documento` - Documento a ser tokenizado.\n","      `tokenizer` - Tokenizador do BERT.\n","    \"\"\"    \n","\n","    # Adiciona os tokens especiais.\n","    documento_marcado = \"[CLS] \" + documento + \" [SEP]\"\n","\n","    # Documento tokenizado\n","    documento_tokenizado = tokenizer.tokenize(documento_marcado)\n","\n","    del tokenizer\n","\n","    return documento_tokenizado    "]},{"cell_type":"markdown","metadata":{"id":"3wvgXwN81RCz"},"source":["### encontrarIndiceSubLista \n","\n","Retorna os índices de início e fim da sublista na lista"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"abS44M4yvFxf"},"outputs":[],"source":["# Localiza os índices de início e fim de uma sublista em uma lista\n","def encontrarIndiceSubLista(lista, sublista):\n","\n","    \"\"\"\n","      Localiza os índices de início e fim de uma sublista em uma lista.\n","    \n","      Parâmetros:\n","      `lista` - Uma lista.\n","      `sublista` - Uma sublista a ser localizada na lista.\n","    \"\"\"    \n","    # https://en.wikipedia.org/wiki/Boyer%E2%80%93Moore%E2%80%93Horspool_algorithm\n","\n","    # Recupera o tamanho da lista \n","    h = len(lista)\n","    # Recupera o tamanho da sublista\n","    n = len(sublista)    \n","    skip = {sublista[i]: n - i - 1 for i in range(n - 1)}\n","    i = n - 1\n","    while i < h:\n","        for j in range(n):\n","            if lista[i - j] != sublista[-j - 1]:\n","                i += skip.get(lista[i], n)\n","                break\n","        else:\n","            indice_inicio = i - n + 1\n","            indice_fim = indice_inicio + len(sublista)-1\n","            return indice_inicio, indice_fim\n","    return -1, -1"]},{"cell_type":"markdown","metadata":{"id":"kGL37G6XFcwp"},"source":["### getEmbeddingSentencaEmbeddingDocumentoComTodasPalavras\n","\n","A partir dos embeddings do documento, localiza o indíce de início e fim de uma sentença no documento e retorna os embeddings da sentença."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"uI07Y_M8__HG"},"outputs":[],"source":["def getEmbeddingSentencaEmbeddingDocumentoComTodasPalavras(embedding_documento, \n","                                                           token_BERT_documento, \n","                                                           sentenca, \n","                                                           tokenizer):\n","\n","  # Tokeniza a sentença\n","  sentenca_tokenizada_BERT = getDocumentoTokenizado(sentenca, tokenizer)\n","#   print(sentenca_tokenizada_BERT)\n","\n","  # Remove os tokens de início e fim da sentença\n","  sentenca_tokenizada_BERT.remove(\"[CLS]\")\n","  sentenca_tokenizada_BERT.remove(\"[SEP]\")    \n","#   print(len(sentenca_tokenizada_BERT))\n","  \n","  # Localiza os índices dos tokens da sentença no documento\n","  inicio, fim = encontrarIndiceSubLista(token_BERT_documento, sentenca_tokenizada_BERT)\n","#   print(inicio,fim) \n"," \n","  # Recupera os embeddings dos tokens da sentença a partir dos embeddings do documento\n","  embedding_sentenca = embedding_documento[inicio:fim+1]\n","  #print(\"embedding_sentenca=\", embedding_sentenca.shape)\n","\n","  del embedding_documento\n","  del token_BERT_documento  \n","  del sentenca\n","  del tokenizer\n","  \n","  # Retorna o embedding da sentença no documento\n","  return embedding_sentenca, sentenca_tokenizada_BERT"]},{"cell_type":"markdown","metadata":{"id":"THFhXGGmIO_r"},"source":["### getEmbeddingDocumentoComTodasPalavrasMean"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"IhW_OiEsIPJI"},"outputs":[],"source":["# Importa a biblioteca\n","import torch\n","\n","def getEmbeddingDocumentoComTodasPalavrasMean(embedding_documento):\n","  \"\"\"\n","    Calcula a média dos embeddings do documento excluindo os tokens \n","    especiais [CLS] do início e [SEP] do fim.\n","    Remove primeira dimensão devido ao cálculo da média.\n","    \n","    Parâmetros:\n","    `embedding_documento` - Embedding do documento.\n","  \"\"\"\n","\n","  # Calcula a média dos embeddings para os tokens de embedding_documento, removendo a primeira dimensão.\n","  # Entrada: <qtde_tokens> x <768 ou 1024>  \n","  #print(\"embedding_documento1=\", embedding_documento.shape)\n","  media_embedding_documento = torch.mean(embedding_documento[1:-1], dim=0)    \n","  # Saída: <768 ou 1024>\n","\n","  del embedding_documento\n","\n","  return media_embedding_documento"]},{"cell_type":"markdown","metadata":{"id":"i7C6tZjpkuQz"},"source":["### getEmbeddingDocumentoSemStopWordMean"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"sT1NB5zDkub1"},"outputs":[],"source":["# Importa a biblioteca\n","import torch\n","\n","def getEmbeddingDocumentoSemStopWordMean(id_documento,\n","                                         index_sentenca, \n","                                         embedding_documento, \n","                                         token_BERT_documento, \n","                                         documento, \n","                                         tokenizer,\n","                                         token_documento, \n","                                         postagging_documento):\n","  \"\"\"\n","    Calcula a média dos embeddings do documento considerando tokens do tipo \n","    especificado no filtro\n","    Remove primeira dimensão devido ao cálculo da média.\n","    \n","    Parâmetros:    \n","    `embedding_documento` - Embeddings do documento gerados pelo BERT.\n","    `token_BERT_documento` - Lista com os tokens do documento gerados pelo tokenizador BERT.\n","    `documento` - Texto com o documento.\n","    `tokenizer` - Tokenizador do BERT.\n","    `token_documento` - Lista com os tokens do documento.\n","    `postagging_documento` - Lista com as POS-Tagging do documento.\n","  \"\"\"  \n","   \n","  # Recupera a lista de tokens do documento, a lista dos postagging e a lista dos seus embeddings com um mesmo tamanho\n","  lista_tokens, lista_postagging, lista_embeddings_mean, lista_embeddings_max = getTokensEmbeddingsPOSSentenca(id_documento, \n","                                                                                                               index_sentenca, \n","                                                                                                               embedding_documento, \n","                                                                                                               token_BERT_documento, \n","                                                                                                               documento,\n","                                                                                                               tokenizer, \n","                                                                                                               token_documento, \n","                                                                                                               postagging_documento)\n","\n","  #print(\"len(token_BERT_documento):\", len(token_BERT_documento))\n","  #print(\"token_BERT_documento:\", token_BERT_documento)\n","  #print(\"len(postagging_documento):\", len(postagging_documento))\n","  #print(\"postagging_documento:\", postagging_documento)\n","  #print(\"filtro:\", filtro)\n","  #print()  \n","  # Lista com os tensores selecionados\n","  lista_tokens_selecionados_mean = []\n","\n","  # Localizar os embeddings dos tokens da sentença tokenizada sem stop word no documento  \n","  for i, token_documento in enumerate(lista_tokens):           \n","      if lista_tokens[i].lower() not in getStopwords(nlp):  \n","          #print(\"Adicionando palavra do embedding:\", lista_tokens[i])\n","          lista_tokens_selecionados_mean.append(lista_embeddings_mean[i])\n","    \n","  if  len(lista_tokens_selecionados_mean) != 0:\n","      # Empilha os embeddings da lista pela dimensão 0\n","      embedding_sem_stopword = torch.stack(lista_tokens_selecionados_mean, dim=0)\n","      #print(\"embedding_sem_stopword.shape:\",embedding_sem_stopword.shape)\n","\n","      # Calcula a média dos embeddings para os tokens de Si, removendo a primeira dimensão.\n","      # Entrada: <qtde_tokens> x <768 ou 1024>  \n","      media_embedding_sem_stopword = torch.mean(embedding_sem_stopword, dim=0)    \n","      # Saída: <768 ou 1024>\n","      #print(\"media_embedding_sem_stopword.shape:\", media_embedding_sem_stopword.shape)\n","  else:\n","      media_embedding_sem_stopword = None\n","\n","  del embedding_documento\n","  del token_BERT_documento\n","  del documento\n","  del tokenizer\n","  del token_documento\n","  del postagging_documento\n","\n","  return media_embedding_sem_stopword"]},{"cell_type":"markdown","metadata":{"id":"1Ko_of60YuNd"},"source":["### getEmbeddingDocumentoRelevanteMean"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"wDokSSODY0Sf"},"outputs":[],"source":["# Importa a biblioteca\n","import torch\n","\n","def getEmbeddingDocumentoRelevanteMean(id_documento, \n","                                       index_sentenca, \n","                                       embedding_documento, \n","                                       token_BERT_documento, \n","                                       documento, \n","                                       tokenizer,\n","                                       token_documento, \n","                                       postagging_documento, \n","                                       filtro):\n","  \"\"\"\n","    Calcula a média dos embeddings do documento considerando tokens do tipo \n","    especificado no filtro\n","    Remove primeira dimensão devido ao cálculo da média.\n","    \n","    Parâmetros:    \n","    `embedding_documento` - Embeddings do documento gerados pelo BERT.\n","    `token_BERT_documento` - Lista com os tokens do documento gerados pelo tokenizador BERT.\n","    `documento` - Texto com o documento.\n","    `tokenizer` - Tokenizador do BERT.\n","    `token_documento` - Lista com os tokens do documento.\n","    `postagging_documento` - Lista com as POS-Tagging do documento.\n","    `filtro` - Filtro dos embeddings.\n","\n","  \"\"\"  \n","   \n","  # Recupera a lista de tokens do documento, a lista dos postagging e a lista dos seus embeddings com um mesmo tamanho\n","  lista_tokens, lista_postagging, lista_embeddings_mean, lista_embeddings_max = getTokensEmbeddingsPOSSentenca(id_documento, \n","                                                                                                               index_sentenca, \n","                                                                                                               embedding_documento, \n","                                                                                                               token_BERT_documento, \n","                                                                                                               documento,\n","                                                                                                               tokenizer, \n","                                                                                                               token_documento, \n","                                                                                                               postagging_documento)\n","\n","  #print(\"len(token_BERT_documento):\", len(token_BERT_documento))\n","  #print(\"token_BERT_documento:\", token_BERT_documento)\n","  #print(\"len(postagging_documento):\", len(postagging_documento))\n","  #print(\"postagging_documento:\", postagging_documento)\n","  #print(\"filtro:\", filtro)\n","  #print()\n","\n","  # Lista com os tensores selecionados\n","  lista_tokens_selecionados = []\n","  # Localizar os embeddings dos tokens da sentença tokenizada sem stop word no documento  \n","  for i, token_documento in enumerate(lista_tokens):     \n","    if (lista_postagging[i] in filtro):          \n","      #print(\"Adicionando palavra do embedding:\", lista_tokens[i])\n","      lista_tokens_selecionados.append(lista_embeddings_mean[i])\n","\n","  if len(lista_tokens_selecionados) != 0:\n","      # Empila os embeddings da lista pela dimensão 0\n","      embedding_relevante = torch.stack(lista_tokens_selecionados, dim=0)\n","      #print(\"embedding_relevante.shape:\",embedding_relevante.shape)\n","\n","      # Calcula a média dos embeddings para os tokens de Si, removendo a primeira dimensão.\n","      # Entrada: <qtde_tokens> x <768 ou 1024>  \n","      media_embedding_relevante = torch.mean(embedding_relevante, dim=0)    \n","      # Saída: <768 ou 1024>\n","      #print(\"media_embedding_relevante.shape:\", media_embedding_relevante.shape)\n","  else:\n","      media_embedding_relevante = None\n","\n","  del embedding_documento\n","  del token_BERT_documento\n","  del documento\n","  del tokenizer\n","  del token_documento\n","  del postagging_documento\n","\n","  return media_embedding_relevante"]},{"cell_type":"markdown","metadata":{"id":"L_vknrk7YSpF"},"source":["### getEmbeddingDocumentoMean\n","\n","Filtros:\n","- ALL - Sentença com todas as palavras\n","- CLEAN - Sentença com todas as palavras menos as stopwords\n","- VERB,AUX - Sentença somente com verbos(VERB e AUX)\n","- NOUN - Sentença somente com substantivos\n","- VERB,NOUN,AUX - Sentença somente com verbos(VERB e AUX) e substantivos"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Pd8B76YyYS02"},"outputs":[],"source":["def getEmbeddingDocumentoMean(id_documento, \n","                              index_sentenca, \n","                              embedding_documento, \n","                              token_BERT_documento, \n","                              documento, \n","                              tokenizer,\n","                              token_documento, \n","                              postagging_documento, \n","                              filtro=[\"ALL\"]):  \n","  \"\"\"\n","    Rediciona o cálculo da média dos embeddings de acordo com o filtro especificado.\n","    \n","    Parâmetros:    \n","    `embedding_documento` - Embeddings do documento gerados pelo BERT.\n","    `token_BERT_documento` - Lista com os tokens do documento gerados pelo tokenizador BERT.\n","    `documento` - Texto com o documento.\n","    `tokenizer` - Tokenizador do BERT.\n","    `token_documento` - Lista com os tokens do documento.\n","    `postagging_documento` - Lista com as POS-Tagging do documento.\n","    `filtro` - Filtro dos embeddings.\n","  \"\"\"\n","\n","  if \"ALL\" in filtro:\n","    return getEmbeddingDocumentoComTodasPalavrasMean(embedding_documento)\n","  else:\n","    if \"CLEAN\" in filtro:\n","      return getEmbeddingDocumentoSemStopWordMean(id_documento, \n","                                                  index_sentenca, \n","                                                  embedding_documento, \n","                                                  token_BERT_documento, \n","                                                  documento, \n","                                                  tokenizer,\n","                                                  token_documento,\n","                                                  postagging_documento)\n","    else:\n","      return getEmbeddingDocumentoRelevanteMean(id_documento, \n","                                                index_sentenca, \n","                                                embedding_documento, \n","                                                token_BERT_documento, \n","                                                documento, \n","                                                tokenizer,\n","                                                token_documento, \n","                                                postagging_documento, \n","                                                filtro)"]},{"cell_type":"markdown","metadata":{"id":"t1PgxcL01VfF"},"source":["### getTokensEmbeddingsPOSSentenca\n","Gera os tokens, POS e embeddings de cada sentença."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"rBkcF2ve1VfG"},"outputs":[],"source":["# Dicionário de tokens de exceções e seus deslocamentos para considerar mais tokens do BERT em relação ao spaCy\n","# A tokenização do BERT gera mais tokens que a tokenização das palavras do spaCy\n","dic_excecao_maior = {\"\":-1,\"Dir-me-ão\":5,\"tê-lo-ão\":5\n","                    }"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fXJk5Od51VfI"},"outputs":[],"source":["def getExcecaoDicMaior(token, dic_excecao_maior):   \n","    \n","  valor = dic_excecao_maior.get(token)\n","  if valor != None:\n","      return valor\n","  else:\n","      return -1"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"M6TSm62Y1VfI"},"outputs":[],"source":["# Dicionário de tokens de exceções e seus deslocamentos para considerar menos tokens do BERT em relação ao spaCy\n","# A tokenização do BERT gera menos tokens que a tokenização das palavras do spaCy\n","dic_excecao_menor = {\"1°\":1,\n","                    }"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"7OYmoFVk1VfJ"},"outputs":[],"source":["def getExcecaoDicMenor(token, dic_excecao_menor):   \n","    \n","  valor = dic_excecao_menor.get(token)\n","  if valor != None:\n","      return valor\n","  else:\n","      return -1"]},{"cell_type":"markdown","metadata":{"id":"JzYA5pPE1VfJ"},"source":["Função que retorna os embeddings, tokens e POS da sentença com um mesmo tamanho."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"W9H1JlTt1VfK"},"outputs":[],"source":["# Importa a biblioteca\n","import torch\n","\n","def getTokensEmbeddingsPOSSentenca(id_documento, \n","                                   index_sentenca, \n","                                   embedding_documento, \n","                                   token_BERT_documento, \n","                                   sentenca, \n","                                   tokenizer, \n","                                   sentenca_token = None, \n","                                   sentenca_postagging = None, \n","                                   estrategia_medida = 0):\n","    \"\"\"    \n","      Retorna os tokens, as POS-Tagging e os embeddings dos tokens igualando a quantidade de tokens do spaCy com a tokenização do BERT de acordo com a estratégia de pooling para palavras fora do vocabulário do BERT. \n","      Usa a estratégia MEAN para calcular a média dos embeddings dos tokens que formam uma palavra fora do vocabulário do BERT.\n","      Usa a estratégia MAX para calcular o valor máximo dos embeddings dos tokens que formam uma palavra fora do vocabulário do BERT.\n","    \"\"\"\n","   \n","    #Guarda os tokens e embeddings\n","    lista_tokens = []\n","    lista_embeddings_mean = []\n","    lista_embeddings_max = []\n","\n","    # Se a sentença não for tokenizada \n","    if sentenca_token == None:\n","      # Gera a tokenização e POS-Tagging da sentença    \n","      sentenca_token, sentenca_postagging = getListaTokensPOSSentenca(sentenca)\n","\n","    # print(\"\\nsentenca                :\",sentenca)    \n","    # print(\"id_documento                :\",id_documento)\n","    # print(\"index_sentenca              :\",index_sentenca)    \n","    # print(\"sentenca_token              :\",sentenca_token)\n","    # print(\"len(sentenca_token)         :\",len(sentenca_token))    \n","    # print(\"sentenca_postagging         :\",sentenca_postagging)\n","    # print(\"len(sentenca_postagging)    :\",len(sentenca_postagging))\n","\n","    # print(\"token_BERT_documento\", token_BERT_documento)\n","    # print(\"sentenca\", sentenca)\n","\n","    \n","    # Recupera os embeddings da sentença dos embeddings dentro dos embeddings do documento    \n","    embedding_sentenca, sentenca_tokenizada_BERT = getEmbeddingSentencaEmbeddingDocumentoComTodasPalavras(embedding_documento, \n","                                                                                                       token_BERT_documento, \n","                                                                                                       sentenca, \n","                                                                                                       tokenizer)\n","    \n","    # embedding <qtde_tokens x 4096>        \n","    #print(\"embedding_sentenca          :\",embedding_sentenca.shape)\n","    #print(\"sentenca_tokenizada_BERT     :\",sentenca_tokenizada_BERT)\n","    #print(\"len(sentenca_tokenizada_BERT):\",len(sentenca_tokenizada_BERT))\n","\n","    # Seleciona os pares de palavra a serem avaliadas\n","    pos_wi = 0 # Posição do token da palavra gerado pelo spaCy\n","    pos_wj = pos_wi # Posição do token da palavra gerado pelo BERT\n","    pos2 = -1\n","\n","    # Enquanto o indíce da palavra pos_wj(2a palavra) não chegou ao final da quantidade de tokens do BERT\n","    while pos_wj < len(sentenca_tokenizada_BERT):  \n","\n","      # Seleciona os tokens da sentença\n","      wi = sentenca_token[pos_wi] # Recupera o token da palavra gerado pelo spaCy\n","      wi1 = \"\"\n","      pos2 = -1\n","      if pos_wi+1 < len(sentenca_token):\n","        wi1 = sentenca_token[pos_wi+1] # Recupera o próximo token da palavra gerado pelo spaCy\n","  \n","        # Localiza o deslocamento da exceção\n","        pos2 = getExcecaoDicMenor(wi+wi1, dic_excecao_menor)  \n","        #print(\"Exceção pos2:\", pos2)\n","\n","      wj = sentenca_tokenizada_BERT[pos_wj] # Recupera o token da palavra gerado pelo BERT\n","      #print(\"wi[\",pos_wi,\"]=\", wi)\n","      #print(\"wj[\",pos_wj,\"]=\", wj)\n","\n","      # Tratando exceções\n","      # Localiza o deslocamento da exceção      \n","      pos = getExcecaoDicMaior( wi, dic_excecao_maior)  \n","      #print(\"Exceção pos:\", pos)\n","            \n","      if pos != -1 or pos2 != -1:      \n","        if pos != -1:\n","          #print(\"Adiciona 1 Exceção palavra == wi or palavra = [UNK]:\",wi)\n","          lista_tokens.append(wi)          \n","          # Verifica se tem mais de um token\n","          if pos != 1:\n","            indice_token = pos_wj + pos\n","            #print(\"Calcula a média de :\", pos_wj , \"até\", indice_token)\n","            embeddings_tokens_palavra = embedding_sentenca[pos_wj:indice_token]\n","            #print(\"embeddings_tokens_palavra:\",embeddings_tokens_palavra.shape)\n","            # calcular a média dos embeddings dos tokens do BERT da palavra\n","            embedding_estrategia_mean = torch.mean(embeddings_tokens_palavra, dim=0)\n","            #print(\"embedding_estrategia_mean:\",embedding_estrategia_mean.shape)\n","            lista_embeddings_mean.append(embedding_estrategia_mean)\n","\n","            # calcular o máximo dos embeddings dos tokens do BERT da palavra\n","            embedding_estrategia_max, linha = torch.max(embeddings_tokens_palavra, dim=0)\n","            #print(\"embedding_estrategia_max:\",embedding_estrategia_max.shape)\n","            lista_embeddings_max.append(embedding_estrategia_max)\n","          else:\n","            # Adiciona o embedding do token a lista de embeddings\n","            lista_embeddings_mean.append(embedding_sentenca[pos_wj])            \n","            lista_embeddings_max.append(embedding_sentenca[pos_wj])\n","         \n","          # Avança para a próxima palavra e token do BERT\n","          pos_wi = pos_wi + 1\n","          pos_wj = pos_wj + pos\n","          #print(\"Proxima:\")            \n","          #print(\"wi[\",pos_wi,\"]=\", sentenca_token[pos_wi])\n","          #print(\"wj[\",pos_wj,\"]=\", sentenca_tokenizada_BERT[pos_wj])\n","        else:\n","          if pos2 != -1:\n","            #print(\"Adiciona 1 Exceção palavra == wi or palavra = [UNK]:\",wi)\n","            lista_tokens.append(wi+wi1)          \n","            # Verifica se tem mais de um token\n","            if pos2 == 1: \n","              # Adiciona o embedding do token a lista de embeddings\n","              lista_embeddings_mean.append(embedding_sentenca[pos_wj])\n","              lista_embeddings_max.append(embedding_sentenca[pos_wj])\n","          \n","            # Avança para a próxima palavra e token do BERT\n","            pos_wi = pos_wi + 2\n","            pos_wj = pos_wj + pos2\n","            #print(\"Proxima:\")            \n","            #print(\"wi[\",pos_wi,\"]=\", sentenca_token[pos_wi])\n","            #print(\"wj[\",pos_wj,\"]=\", sentenca_tokenizada_BERT[pos_wj])\n","      else:  \n","        # Tokens iguais adiciona a lista, o token não possui subtoken\n","        if (wi == wj or wj==\"[UNK]\"):\n","          # Adiciona o token a lista de tokens\n","          #print(\"Adiciona 2 wi==wj or wj==[UNK]:\", wi )\n","          lista_tokens.append(wi)          \n","          # Adiciona o embedding do token a lista de embeddings\n","          lista_embeddings_mean.append(embedding_sentenca[pos_wj])\n","          lista_embeddings_max.append(embedding_sentenca[pos_wj])\n","          #print(\"embedding1[pos_wj]:\", embedding_sentenca[pos_wj].shape)\n","          # Avança para a próxima palavra e token do BERT\n","          pos_wi = pos_wi + 1\n","          pos_wj = pos_wj + 1   \n","              \n","        else:          \n","          # A palavra foi tokenizada pelo Wordpice com ## ou diferente do spaCy ou desconhecida\n","          # Inicializa a palavra a ser montada          \n","          palavra_postagging = wj\n","          indice_token = pos_wj + 1                 \n","          while  ((palavra_postagging != wi) and indice_token < len(sentenca_tokenizada_BERT)):\n","              if \"##\" in sentenca_tokenizada_BERT[indice_token]:\n","                # Remove os caracteres \"##\" do token\n","                parte = sentenca_tokenizada_BERT[indice_token][2:]\n","              else:                \n","                parte = sentenca_tokenizada_BERT[indice_token]\n","              \n","              palavra_postagging = palavra_postagging + parte\n","              #print(\"palavra_postagging:\",palavra_postagging)\n","              # Avança para o próximo token do BERT\n","              indice_token = indice_token + 1\n","\n","          #print(\"\\nMontei palavra:\",palavra_postagging)\n","          if (palavra_postagging == wi or palavra_postagging == \"[UNK]\"):\n","              # Adiciona o token a lista\n","              #print(\"Adiciona 3 palavra == wi or palavra_postagging = [UNK]:\",wi)\n","              lista_tokens.append(wi)\n","              # Calcula a média dos tokens da palavra\n","              #print(\"Calcula o máximo :\", pos_wj , \"até\", indice_token)\n","              embeddings_tokens_palavra = embedding_sentenca[pos_wj:indice_token]\n","              #print(\"embeddings_tokens_palavra2:\",embeddings_tokens_palavra)\n","              #print(\"embeddings_tokens_palavra2:\",embeddings_tokens_palavra.shape)\n","              \n","              # calcular a média dos embeddings dos tokens do BERT da palavra\n","              embedding_estrategia_mean = torch.mean(embeddings_tokens_palavra, dim=0)        \n","              #print(\"embedding_estrategia_mean:\",embedding_estrategia_mean)\n","              #print(\"embedding_estrategia_mean.shape:\",embedding_estrategia_mean.shape)      \n","              lista_embeddings_mean.append(embedding_estrategia_mean)\n","             \n","              # calcular o valor máximo dos embeddings dos tokens do BERT da palavra\n","              embedding_estrategia_max, linha = torch.max(embeddings_tokens_palavra, dim=0)\n","              #print(\"embedding_estrategia_max:\",embedding_estrategia_max)\n","              #print(\"embedding_estrategia_max.shape:\",embedding_estrategia_max.shape)     \n","              lista_embeddings_max.append(embedding_estrategia_max)\n","\n","          # Avança para o próximo token do spaCy\n","          pos_wi = pos_wi + 1\n","          # Pula para o próximo token do BERT\n","          pos_wj = indice_token\n","    \n","    # Verificação se as listas estão com o mesmo tamanho\n","    if (len(lista_tokens) != len(sentenca_token)) or (len(lista_embeddings_mean) != len(sentenca_token)):\n","    # if (len(lista_tokens) !=  len(lista_embeddings_mean)):\n","       print(\"\\nsentenca                  :\",sentenca)  \n","       print(\"id_documento              :\",id_documento)     \n","       print(\"index_sentenca            :\",index_sentenca)\n","       print(\"sentenca_postagging       :\",sentenca_postagging)\n","       print(\"sentenca_token            :\",sentenca_token)\n","       print(\"sentenca_tokenizada_BERT  :\",sentenca_tokenizada_BERT)\n","       print(\"lista_tokens              :\",lista_tokens)        \n","       print(\"len(lista_tokens)         :\",len(lista_tokens))       \n","       print(\"lista_embeddings_mean     :\",lista_embeddings_mean)\n","       print(\"len(lista_embeddings_mean):\",len(lista_embeddings_mean))\n","       print(\"lista_embeddings_max      :\",lista_embeddings_max)\n","       print(\"len(lista_embeddings_max) :\",len(lista_embeddings_max))\n","\n","    del embedding_sentenca\n","    del token_BERT_documento\n","    del tokenizer\n","    del sentenca_tokenizada_BERT\n","    del sentenca_token\n","\n","    return lista_tokens, sentenca_postagging, lista_embeddings_mean, lista_embeddings_max"]},{"cell_type":"markdown","metadata":{"id":"JplTToZvDLiX"},"source":["## Similaridade de cosseno entre os embeddings das sentenças"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"eERVKqh2uk6S"},"outputs":[],"source":["# Import das bibliotecas.\n","from scipy.spatial.distance import cosine\n","\n","def similaridadeCoseno(embeddings1, embeddings2):\n","    \"\"\"\n","    Similaridade do cosseno dos embeddgins dos textos.\n","    \n","    Parâmetros:\n","    `embeddings1` - Um embedding a ser medido.\n","    `embeddings2` - Um embedding a ser medido.\n","    \"\"\"\n","    \n","    similaridade = 1 - cosine(embeddings1, embeddings2)\n","    \n","    return similaridade"]},{"cell_type":"markdown","metadata":{"id":"xKaqQPs8VQ5u"},"source":["### 5.2.1 Medidas de similaridade \n"]},{"cell_type":"markdown","metadata":{"id":"jt06PTN5idrg"},"source":["Similaridade do cosseno entre os embeddings.\n","\n","https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.cosine.html#scipy.spatial.distance.cosine\n","\n","A função spatial.distance.cosine do módulo scipy calcula a distância em vez da similaridade do cosseno, mas para conseguir isso, podemos subtrair o valor da distância de 1.\n","\n","Intervalo de [-1,1] \n","\n","Vetores iguais a distância é igual 1.\n","\n","Vetores diferentes medida próxima de -1."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6vbXj-brOlMF"},"outputs":[],"source":["# Import das bibliotecas.\n","from scipy.spatial.distance import cosine\n","\n","def similaridadeCosseno(embeddings1, embeddings2):\n","    \"\"\"\n","      Similaridade do cosseno dos embeddings dos textos.\n","    \n","      Parâmetros:\n","      `embeddings1` - Um embedding a ser medido.\n","      `embeddings2` - Um embedding a ser medido.\n","    \"\"\"\n","    \n","    similaridade = 1 - cosine(embeddings1, embeddings2)\n","    \n","    return similaridade"]},{"cell_type":"markdown","metadata":{"id":"fazAuLMUr_c0"},"source":["### 5.2.2 Medidas de distância "]},{"cell_type":"markdown","metadata":{"id":"_IcrjAbhwake"},"source":["Distância euclidiana entre os embeddings.\n","\n","Possui outros nomes como distância L2 ou norma L2.\n","\n","https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.euclidean.html#scipy.spatial.distance.euclidean"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"mIrTId9jwakh"},"outputs":[],"source":["# Import das bibliotecas.\n","from scipy.spatial.distance import euclidean\n","\n","def distanciaEuclidiana(embeddings1, embeddings2):\n","    \"\"\"\n","    Distância euclidiana entre os embeddings dos textos.\n","    Possui outros nomes como distância L2 ou norma L2.\n","    \n","    Parâmetros:\n","    `embeddings1` - Um embedding a ser medido.\n","    `embeddings2` - Um embedding a ser medido.\n","    \"\"\"\n","    \n","    distancia = euclidean(embeddings1, embeddings2)\n","    \n","    return distancia"]},{"cell_type":"markdown","metadata":{"id":"-uJlqYCSXdVk"},"source":["Distância Manhattan entre os embeddings.\n","\n","Possui outros nomes como distância Cityblock, distância L1, norma L1 e métrica do táxi.\n","\n","https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.cityblock.html#scipy.spatial.distance.cityblock"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"jFG5UT_SXdVn"},"outputs":[],"source":["# Import das bibliotecas.\n","from scipy.spatial.distance import cityblock\n","\n","def distanciaManhattan(embeddings1, embeddings2):\n","    \"\"\"\n","    Distância Manhattan entre os embeddings dos textos \n","    Possui outros nomes como distância Cityblock, distância L1, norma L1 e métrica do táxi.\n","    \n","    Parâmetros:\n","    `embeddings1` - Um embedding a ser medido.\n","    `embeddings2` - Um embedding a ser medido.\n","    \"\"\"\n","    \n","    distancia = cityblock(embeddings1, embeddings2)\n","\n","    return distancia"]},{"cell_type":"markdown","metadata":{"id":"S6A6-Xwg8GJw"},"source":["### 5.2.3 Retorna as medidas dos embeddings"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"qHzQ98zg8GWJ"},"outputs":[],"source":["def getMedidasEmbedding(embedding_wi, embedding_wj):\n","\n","  \"\"\"\n","    Retorna as medidas de similaridade do cosseno(cos), distância Euclidiana(euc) e \n","    distância de Manhattan(man) entre os embeddings.\n","        \n","    Parâmetros:\n","    `embeddings_wi` - Um embedding de uma palavra a ser medido.\n","    `embeddings_wj` - Um embedding de uma palavra a ser medido.\n","  \"\"\"\n"," \n","  #print(\"embedding_wi=\", embedding_wi.shape) \n","  #print(\"embedding_wj=\", embedding_wj.shape)\n","\n","  # Similaridade do cosseno entre os embeddings wi e wj\n","  # Entrada: (<768 ou 1024>) x (<768 ou 1024>)\n","  cos = similaridadeCosseno(embedding_wi, embedding_wj)\n","  # Saída: Número real\n","\n","  # Distância euclidiana entre os embeddings wi e wj\n","  # Entrada: (<768 ou 1024>) x (<768 ou 1024>)\n","  euc = distanciaEuclidiana(embedding_wi, embedding_wj)\n","  # Saída: Número real\n","\n","  # Distância de manhattan entre os embeddings wi e wj\n","  # Entrada: (<768 ou 1024>) x (<768 ou 1024>)\n","  man = distanciaManhattan(embedding_wi, embedding_wj)\n","  # Saída: Número real\n","  \n","  del embedding_wi\n","  del embedding_wj\n","\n","  # Retorno das medidas das sentenças\n","  return cos, euc, man"]},{"cell_type":"markdown","metadata":{"id":"Y7W-7V3QFbpR"},"source":["\n","# 3 Carrega dados"]},{"cell_type":"markdown","metadata":{"id":"oQUy9Tat2EF_"},"source":["## 3.1 Carregamento dos arquivos de dados originais e permutados"]},{"cell_type":"markdown","metadata":{"id":"bD_tNbBGPrnE"},"source":["### 3.1.1 Especifica os nomes dos arquivos de dados\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bNgwJRC2uGJb"},"outputs":[],"source":["# Nome do arquivo\n","# Nome do arquivo original\n","# NOME_ARQUIVO_DOCUMENTO_FILTRADO = \"original_filtrado_vitimas_algoz.csv\"\n","NOME_ARQUIVO_DOCUMENTO_FILTRADO = \"original_filtrado.csv\"\n","\n","# NOME_ARQUIVO_DOCUMENTO_FILTRADO_COMPACTADO = \"original_filtrado_vitimas_algoz.zip\"\n","NOME_ARQUIVO_DOCUMENTO_FILTRADO_COMPACTADO = \"original_filtrado.zip\"\n","\n"]},{"cell_type":"markdown","metadata":{"id":"I0LsmsBlJeeV"},"source":["### 3.1.2 Cria o diretório local para receber os dados"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":16,"status":"ok","timestamp":1670461783760,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"gFYIHcIHE985","outputId":"6a1a9dfb-988e-475a-93bb-41019f63ba1d"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Diretório já existe: /content/MODERNIST\n"]}],"source":["# Importando as bibliotecas.\n","import os\n","\n","# Cria o diretório para receber os arquivos Originais e Permutados\n","# Diretório a ser criado\n","dirbase = DIRETORIO_LOCAL[:-1]\n","\n","if not os.path.exists(dirbase):  \n","    # Cria o diretório\n","    os.makedirs(dirbase)    \n","    logging.info(\"Diretório criado: {}\".format(dirbase))\n","else:    \n","    logging.info(\"Diretório já existe: {}\".format(dirbase))"]},{"cell_type":"markdown","metadata":{"id":"D8A9syejCsD2"},"source":["### 3.1.3 Copia os arquivos do Google Drive para o Colaboratory"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1549,"status":"ok","timestamp":1670461785302,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"pviuxToMCxQw","outputId":"65465c2b-8a37-4151-dc4f-65cd7d3c411c"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Terminei a cópia.\n"]}],"source":["# Se estiver executando no Google Colaboratory\n","if IN_COLAB:\n","\n","  !cp \"$DIRETORIO_DRIVE$NOME_ARQUIVO_DOCUMENTO_FILTRADO_COMPACTADO\" \"$DIRETORIO_LOCAL\"\n","\n","  logging.info(\"Terminei a cópia.\")"]},{"cell_type":"markdown","metadata":{"id":"rFCvZ6CUmt-9"},"source":["Descompacta os arquivos.\n","\n","Usa o unzip para descompactar:\n","*   `-o` sobrescreve o arquivo se existir\n","*   `-j` Não cria nenhum diretório\n","*   `-q` Desliga as mensagens \n","*   `-d` Diretório de destino\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1670461785302,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"dbHl3d88mouc","outputId":"930f008d-135b-487f-fa3a-137ecfe7bbe6"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Terminei a descompactação.\n"]}],"source":["# Se estiver executando no Google Colaboratory\n","if IN_COLAB:\n","  !unzip -o -j -q \"$DIRETORIO_LOCAL$NOME_ARQUIVO_DOCUMENTO_FILTRADO_COMPACTADO\" -d \"$DIRETORIO_LOCAL\"\n","\n","  logging.info(\"Terminei a descompactação.\")"]},{"cell_type":"markdown","metadata":{"id":"qzhYJNWJm1z4"},"source":["### 3.1.4 Carregamento das lista com os dados dos arquivos originais"]},{"cell_type":"markdown","metadata":{"id":"Usr1uRzQeJSb"},"source":["#### Carrega o arquivo dos dados originais e POS"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":459,"status":"ok","timestamp":1670461785758,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"QRHlixdHEDTb","outputId":"6affd25b-ecb1-485e-ba15-9b318cd70680"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:TERMINADO ORIGINAIS: 1844.\n"]}],"source":["# Import das bibliotecas.\n","import pandas as pd\n","\n","# Abre o arquivo e retorna o DataFrame\n","lista_documentos_originais_filtrados = pd.read_csv(DIRETORIO_LOCAL + NOME_ARQUIVO_DOCUMENTO_FILTRADO, sep=\";\", encoding=\"UTF-8\")\n","\n","\n","logging.info(\"TERMINADO ORIGINAIS: {}.\".format(len(lista_documentos_originais_filtrados)))\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"mzl2SUe7N4QM"},"outputs":[],"source":["# lista_documentos_originais = lista_documentos_originais[:5]"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":27,"status":"ok","timestamp":1670461785760,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"jJ5STBZPLlie","outputId":"b2a843ca-433e-4022-9883-81c2c84acbd2"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-5d057ae2-7977-4fa3-babe-fa0def95573f\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>documento</th>\n","      <th>documentoTokens</th>\n","      <th>posDocumento</th>\n","      <th>idOcorrencia</th>\n","      <th>palavraAlvo</th>\n","      <th>grupo</th>\n","      <th>obra</th>\n","      <th>autor</th>\n","      <th>ano</th>\n","      <th>idObra</th>\n","      <th>movimento</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>338</th>\n","      <td>200807</td>\n","      <td>Mas o amor cego que não educa o escravo simpát...</td>\n","      <td>['Mas', 'o', 'amor', 'cego', 'que', 'não', 'ed...</td>\n","      <td>['CCONJ', 'DET', 'NOUN', 'ADJ', 'PRON', 'ADV',...</td>\n","      <td>8</td>\n","      <td>escravo</td>\n","      <td>escravo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>200019</td>\n","      <td>E o vendelhão é em regra a vigilância protetor...</td>\n","      <td>['E', 'o', 'vendelhão', 'é', 'em', 'regra', 'a...</td>\n","      <td>['CCONJ', 'DET', 'NOUN', 'AUX', 'ADP', 'NOUN',...</td>\n","      <td>28</td>\n","      <td>senhores</td>\n","      <td>senhor</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>1403</th>\n","      <td>203001</td>\n","      <td>A influência da mucama escrava produzia seus n...</td>\n","      <td>['A', 'influência', 'da', 'mucama', 'escrava',...</td>\n","      <td>['DET', 'NOUN', 'ADP', 'NOUN', 'VERB', 'VERB',...</td>\n","      <td>4</td>\n","      <td>escrava</td>\n","      <td>escravo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>1703</th>\n","      <td>204766</td>\n","      <td>Entretanto Leonídia cometera inocente erro, fa...</td>\n","      <td>['Entretanto', 'Leonídia', 'cometera', 'inocen...</td>\n","      <td>['ADV', 'PROPN', 'VERB', 'ADJ', 'NOUN', 'PUNCT...</td>\n","      <td>10</td>\n","      <td>senhora</td>\n","      <td>senhor</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>680</th>\n","      <td>201400</td>\n","      <td>– Mas, Pai-Raiol, você que me quer sua companh...</td>\n","      <td>['–', 'Mas', ',', 'Pai-Raiol', ',', 'você', 'q...</td>\n","      <td>['PUNCT', 'CCONJ', 'PUNCT', 'PROPN', 'PUNCT', ...</td>\n","      <td>20</td>\n","      <td>senhor</td>\n","      <td>senhor</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-5d057ae2-7977-4fa3-babe-fa0def95573f')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-5d057ae2-7977-4fa3-babe-fa0def95573f button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-5d057ae2-7977-4fa3-babe-fa0def95573f');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["          id                                          documento  \\\n","338   200807  Mas o amor cego que não educa o escravo simpát...   \n","5     200019  E o vendelhão é em regra a vigilância protetor...   \n","1403  203001  A influência da mucama escrava produzia seus n...   \n","1703  204766  Entretanto Leonídia cometera inocente erro, fa...   \n","680   201400  – Mas, Pai-Raiol, você que me quer sua companh...   \n","\n","                                        documentoTokens  \\\n","338   ['Mas', 'o', 'amor', 'cego', 'que', 'não', 'ed...   \n","5     ['E', 'o', 'vendelhão', 'é', 'em', 'regra', 'a...   \n","1403  ['A', 'influência', 'da', 'mucama', 'escrava',...   \n","1703  ['Entretanto', 'Leonídia', 'cometera', 'inocen...   \n","680   ['–', 'Mas', ',', 'Pai-Raiol', ',', 'você', 'q...   \n","\n","                                           posDocumento  idOcorrencia  \\\n","338   ['CCONJ', 'DET', 'NOUN', 'ADJ', 'PRON', 'ADV',...             8   \n","5     ['CCONJ', 'DET', 'NOUN', 'AUX', 'ADP', 'NOUN',...            28   \n","1403  ['DET', 'NOUN', 'ADP', 'NOUN', 'VERB', 'VERB',...             4   \n","1703  ['ADV', 'PROPN', 'VERB', 'ADJ', 'NOUN', 'PUNCT...            10   \n","680   ['PUNCT', 'CCONJ', 'PUNCT', 'PROPN', 'PUNCT', ...            20   \n","\n","     palavraAlvo    grupo                obra                     autor   ano  \\\n","338      escravo  escravo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","5       senhores   senhor  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","1403     escrava  escravo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","1703     senhora   senhor  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","680       senhor   senhor  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","\n","      idObra   movimento  \n","338        2  Romantismo  \n","5          2  Romantismo  \n","1403       2  Romantismo  \n","1703       2  Romantismo  \n","680        2  Romantismo  "]},"execution_count":91,"metadata":{},"output_type":"execute_result"}],"source":["lista_documentos_originais_filtrados.sample(5)"]},{"cell_type":"markdown","metadata":{"id":"0PPCl45c_Fys"},"source":["#### Corrigir os tipos de colunas dos dados originais_filtrados\n","\n","Em dados originais_filtrados:\n","- coluna 1 - `documentoTokens` carregadas do arquivo vem como string e não como lista.\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":27,"status":"ok","timestamp":1670461785761,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"uSmIpa1Q_Fys","outputId":"b721d762-7416-4945-f801-1d3c76c722cd"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:TERMINADO CORREÇÃO ORIGINAIS_FILTRADOS: 1844.\n"]}],"source":["# Import das bibliotecas.\n","import ast # Biblioteca para conversão de string em lista\n","\n","# Verifica se o tipo da coluna não é list e converte\n","lista_documentos_originais_filtrados[\"documentoTokens\"] = lista_documentos_originais_filtrados[\"documentoTokens\"].apply(lambda x: ast.literal_eval(x) if type(x)!=list else x)\n","lista_documentos_originais_filtrados[\"posDocumento\"] = lista_documentos_originais_filtrados[\"posDocumento\"].apply(lambda x: ast.literal_eval(x) if type(x)!=list else x)\n","\n","\n","logging.info(\"TERMINADO CORREÇÃO ORIGINAIS_FILTRADOS: {}.\".format(len(lista_documentos_originais_filtrados)))\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"elapsed":26,"status":"ok","timestamp":1670461785761,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"RyF2Q8H4_Fyt","outputId":"a73eae6d-f85b-419c-c676-18a6de6cfc4e"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-7932cf58-c3ce-4628-9b4d-573f53b01729\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>documento</th>\n","      <th>documentoTokens</th>\n","      <th>posDocumento</th>\n","      <th>idOcorrencia</th>\n","      <th>palavraAlvo</th>\n","      <th>grupo</th>\n","      <th>obra</th>\n","      <th>autor</th>\n","      <th>ano</th>\n","      <th>idObra</th>\n","      <th>movimento</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>1472</th>\n","      <td>203534</td>\n","      <td>Souvanel chegou-se para a crioula e perguntou:...</td>\n","      <td>[Souvanel, chegou-se, para, a, crioula, e, per...</td>\n","      <td>[PROPN, VERB, ADP, DET, NOUN, CCONJ, VERB, PUN...</td>\n","      <td>4</td>\n","      <td>crioula</td>\n","      <td>crioulo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>625</th>\n","      <td>201280</td>\n","      <td>Esméria não pensava mais nas suspeitas que tiv...</td>\n","      <td>[Esméria, não, pensava, mais, nas, suspeitas, ...</td>\n","      <td>[PROPN, ADV, VERB, ADV, ADP, NOUN, PRON, VERB,...</td>\n","      <td>18</td>\n","      <td>crioula</td>\n","      <td>crioulo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>1458</th>\n","      <td>203459</td>\n","      <td>– Minha senhora não quer escrever...</td>\n","      <td>[–, Minha, senhora, não, quer, escrever, ...]</td>\n","      <td>[PUNCT, PROPN, NOUN, ADV, VERB, VERB, PUNCT]</td>\n","      <td>2</td>\n","      <td>senhora</td>\n","      <td>senhor</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>1575</th>\n","      <td>204111</td>\n","      <td>Enfim Lucinda voltou, e chegou-se ao leito de ...</td>\n","      <td>[Enfim, Lucinda, voltou, ,, e, chegou-se, ao, ...</td>\n","      <td>[ADV, PROPN, VERB, PUNCT, CCONJ, VERB, ADP, NO...</td>\n","      <td>10</td>\n","      <td>senhora</td>\n","      <td>senhor</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>746</th>\n","      <td>201469</td>\n","      <td>mas, grosseiro escravo da sensualidade, sofism...</td>\n","      <td>[mas, ,, grosseiro, escravo, da, sensualidade,...</td>\n","      <td>[CCONJ, PUNCT, ADJ, NOUN, ADP, NOUN, PUNCT, VE...</td>\n","      <td>3</td>\n","      <td>escravo</td>\n","      <td>escravo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-7932cf58-c3ce-4628-9b4d-573f53b01729')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-7932cf58-c3ce-4628-9b4d-573f53b01729 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-7932cf58-c3ce-4628-9b4d-573f53b01729');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["          id                                          documento  \\\n","1472  203534  Souvanel chegou-se para a crioula e perguntou:...   \n","625   201280  Esméria não pensava mais nas suspeitas que tiv...   \n","1458  203459               – Minha senhora não quer escrever...   \n","1575  204111  Enfim Lucinda voltou, e chegou-se ao leito de ...   \n","746   201469  mas, grosseiro escravo da sensualidade, sofism...   \n","\n","                                        documentoTokens  \\\n","1472  [Souvanel, chegou-se, para, a, crioula, e, per...   \n","625   [Esméria, não, pensava, mais, nas, suspeitas, ...   \n","1458      [–, Minha, senhora, não, quer, escrever, ...]   \n","1575  [Enfim, Lucinda, voltou, ,, e, chegou-se, ao, ...   \n","746   [mas, ,, grosseiro, escravo, da, sensualidade,...   \n","\n","                                           posDocumento  idOcorrencia  \\\n","1472  [PROPN, VERB, ADP, DET, NOUN, CCONJ, VERB, PUN...             4   \n","625   [PROPN, ADV, VERB, ADV, ADP, NOUN, PRON, VERB,...            18   \n","1458       [PUNCT, PROPN, NOUN, ADV, VERB, VERB, PUNCT]             2   \n","1575  [ADV, PROPN, VERB, PUNCT, CCONJ, VERB, ADP, NO...            10   \n","746   [CCONJ, PUNCT, ADJ, NOUN, ADP, NOUN, PUNCT, VE...             3   \n","\n","     palavraAlvo    grupo                obra                     autor   ano  \\\n","1472     crioula  crioulo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","625      crioula  crioulo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","1458     senhora   senhor  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","1575     senhora   senhor  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","746      escravo  escravo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","\n","      idObra   movimento  \n","1472       2  Romantismo  \n","625        2  Romantismo  \n","1458       2  Romantismo  \n","1575       2  Romantismo  \n","746        2  Romantismo  "]},"execution_count":93,"metadata":{},"output_type":"execute_result"}],"source":["lista_documentos_originais_filtrados.sample(5)"]},{"cell_type":"markdown","metadata":{"id":"8yyRt4jnYxsU"},"source":["#### Analise dos dados originais com janela"]},{"cell_type":"markdown","metadata":{"id":"pOzDVi7PR6RE"},"source":["### **adicionar indice da palavra chave, indice sup e inf da jenala, palavra chave**\n","\n","utilizar a posição originão sem o acrecimo do + 1 no indice superior\n","\n","criar uma lista d onde "]},{"cell_type":"markdown","metadata":{"id":"kV4ZjkGDWeLl"},"source":["#### filtra as coisas \n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"TOx5vfZtS4Wm"},"outputs":[],"source":["data = {\n","    0:{\"label\":\"negro\", \"alvo\":[\"negro\",\"negros\",\"negrinho\",\"negrinhos\",\"negra\",\"negras\",\"negrinha\",\"negrinhas\"]},\n","    1:{\"label\":\"crioulo\", \"alvo\": [\"crioulo\",\"crioulos\",\"crioulinho\",\"crioulinhos\",\"crioula\",\"crioulas\",\"crioulinha\",\"crioulinhas\"]},\n","    2:{\"label\":\"mulato\", \"alvo\":[\"mulato\",\"mulatos\",\"mulatinho\",\"mulatinhos\",\"mulata\",\"mulatas\",\"mulatinha\",\"mulatinhas\"]},\n","    3:{\"label\":\"criado\", \"alvo\":[\"criado\",\"criados\",\"criadinho\",\"criadinhos\",\"criada\",\"criadas\",\"criadinha\",\"criadinhas\"]},\n","    4:{\"label\":\"escravo\", \"alvo\":[\"escravo\",\"escravos\",\"escravinho\",\"escravinhos\",\"escrava\",\"escravas\",\"escravinha\",\"escravinhas\"]},\n","    5:{\"label\":\"senhor\", \"alvo\":[\"senhor\",\"senhores\",\"senhora\",\"senhoras\",]},\n","    6:{\"label\":\"branco\", \"alvo\":[\"branco\",\"brancos\",\"branca\",\"brancas\",]},\n","    }"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":25,"status":"ok","timestamp":1670461785762,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"1MtjtalaToM8","outputId":"2fb59844-ae38-4dfc-d7b7-a22b2c704c27"},"outputs":[{"name":"stdout","output_type":"stream","text":["{'label': 'negro', 'alvo': ['negro', 'negros', 'negrinho', 'negrinhos', 'negra', 'negras', 'negrinha', 'negrinhas']}\n"]}],"source":["print(data[0])"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":22,"status":"ok","timestamp":1670461785762,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"dSyALL0UM6L1","outputId":"abc8b9ed-408c-48ec-cfb1-1e7a72f4b70a"},"outputs":[{"data":{"text/plain":["array(['escravos', 'senhores', 'escravo', 'senhor', 'negro', 'crioulo',\n","       'escrava', 'crioulinho', 'senhora', 'criado', 'negra', 'crioulos',\n","       'criados', 'negros', 'escravas', 'branca', 'branco', 'senhoras',\n","       'brancos', 'crioula', 'negras', 'crioulas', 'criada',\n","       'crioulinhos'], dtype=object)"]},"execution_count":96,"metadata":{},"output_type":"execute_result"}],"source":["lista_documentos_originais_filtrados['palavraAlvo'].unique()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":19,"status":"ok","timestamp":1670461785762,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"xDuz26qmNAzW","outputId":"e5459355-34df-49fb-8b96-d9f4b7b1c5eb"},"outputs":[{"data":{"text/plain":["array(['escravo', 'senhor', 'negro', 'crioulo', 'criado', 'branco'],\n","      dtype=object)"]},"execution_count":97,"metadata":{},"output_type":"execute_result"}],"source":["lista_documentos_originais_filtrados['grupo'].unique()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":16,"status":"ok","timestamp":1670461785763,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"pKvgWN0gNVJL","outputId":"2ba9a51e-bf9b-47ee-c4fe-867d668a2fda"},"outputs":[{"data":{"text/plain":["1844"]},"execution_count":98,"metadata":{},"output_type":"execute_result"}],"source":["len(lista_documentos_originais_filtrados)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"5puokWdWPwxR"},"outputs":[],"source":["palavras_alvo = data[0]['alvo'][0]\n","labels = data[0]['label']"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":13,"status":"ok","timestamp":1670461785763,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"2B8JtOBTUegt","outputId":"ace141c4-ad4e-4313-e957-a6a0bad911d2"},"outputs":[{"name":"stdout","output_type":"stream","text":["labels negro palavras_alvo negro\n"]}],"source":["print(\"labels\",labels,\"palavras_alvo\",palavras_alvo)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"9JGuFuP5MidR"},"outputs":[],"source":["lista_documentos_filtrados = lista_documentos_originais_filtrados "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":460,"status":"ok","timestamp":1670461786213,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"k5pLFDvyNXT7","outputId":"cafc2a43-0504-4e24-c6a8-1fa822b8b3db"},"outputs":[{"data":{"text/plain":["1844"]},"execution_count":102,"metadata":{},"output_type":"execute_result"}],"source":["len(lista_documentos_filtrados)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":10,"status":"ok","timestamp":1670461786214,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"uvVO_dOrAwmP","outputId":"b800c035-0001-4c15-ad01-f7ad6ab6f6c7"},"outputs":[{"data":{"text/plain":["array([ 49,  60,  52,   3,  32,  28,  22,  62, 105,  59,  45,   6,  10,\n","         5,  15,  18,  64,   2,  20,  35,   1,  14,  57, 100,  23,  34,\n","        38,   4,   7,  40,  13,  26,  12,  27,  17,  67,  48,  24,   8,\n","        36,  95,  33,  56,  51, 133,  41,  42,  65,  47,  53,  55,  73,\n","        94,  19,  25,  68,   9,  21,  54,  31,  78,  11,  37,  86,  16,\n","        30,  61,  76,  39,  50,   0,  66,  75, 158, 103, 131, 141,  58,\n","       118,  44, 104,  70,  93,  29,  43,  63,  92,  83, 112,  84,  71,\n","        72,  77,  69,  46, 102, 116, 204,  87, 107, 165, 101, 108, 115,\n","        80])"]},"execution_count":103,"metadata":{},"output_type":"execute_result"}],"source":["lista_documentos_filtrados[\"idOcorrencia\"].unique()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1670461786214,"user":{"displayName":"Leandro Dias","userId":"15287680885186282361"},"user_tz":180},"id":"oKw-Zo2koYsy","outputId":"434de429-478a-426b-8774-356ec41fd078"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-de27ce53-f0db-4b57-86e7-d9f228aded51\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>documento</th>\n","      <th>documentoTokens</th>\n","      <th>posDocumento</th>\n","      <th>idOcorrencia</th>\n","      <th>palavraAlvo</th>\n","      <th>grupo</th>\n","      <th>obra</th>\n","      <th>autor</th>\n","      <th>ano</th>\n","      <th>idObra</th>\n","      <th>movimento</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>200016</td>\n","      <td>Explorador das trevas protetoras dos vícios e ...</td>\n","      <td>[Explorador, das, trevas, protetoras, dos, víc...</td>\n","      <td>[NOUN, ADP, NOUN, ADJ, ADP, NOUN, CCONJ, ADP, ...</td>\n","      <td>49</td>\n","      <td>escravos</td>\n","      <td>escravo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>200016</td>\n","      <td>Explorador das trevas protetoras dos vícios e ...</td>\n","      <td>[Explorador, das, trevas, protetoras, dos, víc...</td>\n","      <td>[NOUN, ADP, NOUN, ADJ, ADP, NOUN, CCONJ, ADP, ...</td>\n","      <td>60</td>\n","      <td>escravos</td>\n","      <td>escravo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>200016</td>\n","      <td>Explorador das trevas protetoras dos vícios e ...</td>\n","      <td>[Explorador, das, trevas, protetoras, dos, víc...</td>\n","      <td>[NOUN, ADP, NOUN, ADJ, ADP, NOUN, CCONJ, ADP, ...</td>\n","      <td>52</td>\n","      <td>senhores</td>\n","      <td>senhor</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>200018</td>\n","      <td>vêm os quilombolas escravos fugidos e acoitado...</td>\n","      <td>[vêm, os, quilombolas, escravos, fugidos, e, a...</td>\n","      <td>[VERB, DET, NOUN, ADJ, VERB, CCONJ, VERB, ADP,...</td>\n","      <td>3</td>\n","      <td>escravos</td>\n","      <td>escravo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>200019</td>\n","      <td>E o vendelhão é em regra a vigilância protetor...</td>\n","      <td>[E, o, vendelhão, é, em, regra, a, vigilância,...</td>\n","      <td>[CCONJ, DET, NOUN, AUX, ADP, NOUN, DET, NOUN, ...</td>\n","      <td>32</td>\n","      <td>escravos</td>\n","      <td>escravo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-de27ce53-f0db-4b57-86e7-d9f228aded51')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-de27ce53-f0db-4b57-86e7-d9f228aded51 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-de27ce53-f0db-4b57-86e7-d9f228aded51');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["       id                                          documento  \\\n","0  200016  Explorador das trevas protetoras dos vícios e ...   \n","1  200016  Explorador das trevas protetoras dos vícios e ...   \n","2  200016  Explorador das trevas protetoras dos vícios e ...   \n","3  200018  vêm os quilombolas escravos fugidos e acoitado...   \n","4  200019  E o vendelhão é em regra a vigilância protetor...   \n","\n","                                     documentoTokens  \\\n","0  [Explorador, das, trevas, protetoras, dos, víc...   \n","1  [Explorador, das, trevas, protetoras, dos, víc...   \n","2  [Explorador, das, trevas, protetoras, dos, víc...   \n","3  [vêm, os, quilombolas, escravos, fugidos, e, a...   \n","4  [E, o, vendelhão, é, em, regra, a, vigilância,...   \n","\n","                                        posDocumento  idOcorrencia  \\\n","0  [NOUN, ADP, NOUN, ADJ, ADP, NOUN, CCONJ, ADP, ...            49   \n","1  [NOUN, ADP, NOUN, ADJ, ADP, NOUN, CCONJ, ADP, ...            60   \n","2  [NOUN, ADP, NOUN, ADJ, ADP, NOUN, CCONJ, ADP, ...            52   \n","3  [VERB, DET, NOUN, ADJ, VERB, CCONJ, VERB, ADP,...             3   \n","4  [CCONJ, DET, NOUN, AUX, ADP, NOUN, DET, NOUN, ...            32   \n","\n","  palavraAlvo    grupo                obra                     autor   ano  \\\n","0    escravos  escravo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","1    escravos  escravo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","2    senhores   senhor  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","3    escravos  escravo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","4    escravos  escravo  As Vítimas-Algozes  Joaquim Manuel de Macedo  1869   \n","\n","   idObra   movimento  \n","0       2  Romantismo  \n","1       2  Romantismo  \n","2       2  Romantismo  \n","3       2  Romantismo  \n","4       2  Romantismo  "]},"execution_count":104,"metadata":{},"output_type":"execute_result"}],"source":["lista_documentos_filtrados.head()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"vAeGNdjkHOxF"},"outputs":[],"source":["TAMANHO_JANELA = 9\n","DISTANCIA_DA_PALAVRA_ALVO = (TAMANHO_JANELA-1)/2"]},{"cell_type":"markdown","metadata":{"id":"v9vT0xFZv3Dw"},"source":["###  3.2.1 gera embeddings"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/","height":49,"referenced_widgets":["8beec1d6adf047db93139a0e395bfad0","3ad094efc38440369652f4262b0698c6","6c74147767ea4ca9a484c4799af7290d","0b5774bc70324a328c7dc755eb6227de","6f38837e61d244a5b5bd09b2aa73ecfe","e0a9258e8efa4871b24cfa46ed0db1bf","f96b23a4db61425c8538952617964520","077c9d8f1e2c47f08fe7fddd63848fbb","287de2f7aaaa4e26900b4370e7401a04","08ed280b109f4fceabab67030ae185b2","39701e4d4f0e417bae2a84572c66366d"]},"id":"NMrd5JtU6UNB","outputId":"89fe4a63-7e3f-4985-b2a4-77a3623996a7"},"outputs":[{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"8beec1d6adf047db93139a0e395bfad0","version_major":2,"version_minor":0},"text/plain":["Documentos:   0%|          | 0/1843 [00:00<?, ? documento/s]"]},"metadata":{},"output_type":"display_data"}],"source":["# Import das bibliotecas.\n","from tqdm.notebook import tqdm as tqdm_notebook\n","\n","lista_documentos_filtrados_emb = [];\n","\n","# perccore a lista de documento inicio ate final-1\n","documentos_bar = tqdm_notebook(lista_documentos_filtrados.iterrows(), desc=f\"Documentos\", unit=f\" documento\", total=len(lista_documentos_filtrados[:-1]))  \n","for index, row in documentos_bar:\n","    \n","    \n","    sw1_id = row[\"id\"]\n","    sw1_documento = row[\"documento\"]\n","    sw1_documentoTokens = row[\"documentoTokens\"]\n","    sw1_posDocumento = row[\"posDocumento\"]\n","    sw1_idOcorrencia = row[\"idOcorrencia\"]\n","    sw1_palavraAlvo = row[\"palavraAlvo\"]\n","    sw1_grupo = row['grupo']\n","    sw1_obra = row[\"obra\"]\n","    sw1_autor = row[\"autor\"]\n","    sw1_ano = row[\"ano\"]\n","    sw1_idObra = row[\"idObra\"]\n","    sw1_movimento = row[\"movimento\"]\n","    sw1_document = \" \".join(sw1_documentoTokens)\n","    sw1_length = len(sw1_documentoTokens)\n","    sw1_length = TAMANHO_JANELA\n","    \n","    # TAMANHO_JANELA = 7\n","    # DISTANCIA_DA_PALAVRA_ALVO = (TAMANHO_JANELA-1)/2\n","\n","    posicaoInferior = int(sw1_idOcorrencia - DISTANCIA_DA_PALAVRA_ALVO)\n","    posicaoSuperior = int(sw1_idOcorrencia + DISTANCIA_DA_PALAVRA_ALVO +1)\n","\n","    # print('sw1_id', sw1_id)\n","    # print('sw1_idOcorrencia ',sw1_idOcorrencia)\n","    # print('posicaoInferior ',posicaoInferior)\n","    # print('posicaoSuperior ',posicaoSuperior)\n","    # print('sw1_documentoTokens ',len(sw1_documentoTokens))\n","\n","    if posicaoInferior < 0 or posicaoSuperior > len(sw1_documentoTokens):\n","        continue\n","\n","\n","    # print('sw1_documentoTokens        ',sw1_documentoTokens)\n","\n","    sw1_janela_documentoTokens = sw1_documentoTokens[posicaoInferior:posicaoSuperior]\n","\n","    # alteração 16/09/2022 10:11\n","    sw1_document = \" \".join(sw1_documentoTokens)\n","\n","    # alteração 16/09/2022 10:11\n","    sw1_janela_documento = \" \".join(sw1_janela_documentoTokens)\n","\n","    # gerar os embeddings do documento sw1\n","    sw1_embedding_documento, sw1_token_BERT_documento = getEmbeddingsDocumento(sw1_document, model, tokenizer) \n","\n","    sw1_sentenca_token = sw1_documentoTokens    \n","    sw1_sentenca_postagging = sw1_posDocumento\n","\n","    # Realiza uma contenação dos tokens da sentença\n","    sw1_sentenca_concatenada = \" \".join(sw1_sentenca_token)\n","    # print(\"sentenca_concatenada:\", sentenca_concatenada)\n","\n","    sw1_lista_tokens, sw1_lista_postagging, sw1_lista_embeddings_mean, sw1_lista_embeddings_max = getTokensEmbeddingsPOSSentenca(sw1_id, \n","                                                                                                    index, \n","                                                                                                    sw1_embedding_documento,\n","                                                                                                    sw1_token_BERT_documento, \n","                                                                                                    sw1_sentenca_concatenada, \n","                                                                                                    tokenizer, \n","                                                                                                    sw1_sentenca_token, \n","                                                                                                    sw1_sentenca_postagging) \n","   \n","    sw1_lista_embeddings_janela_mean = sw1_lista_embeddings_mean[posicaoInferior:posicaoSuperior]\n","\n","    sw1_janela_mean_stack = torch.stack(sw1_lista_embeddings_janela_mean, dim=0)\n","    \n","\n","    sw1_janela_mean = torch.mean(sw1_janela_mean_stack,dim=0)\n","    \n","    \n","    sw1_embeddings_janela_mean = sw1_janela_mean.numpy().tolist()\n","    # print(sw1_embeddings_janela_mean)\n","\n","    \n","    # print(\"medidas :\",sw_cos_mean_cached,sw_euc_mean_cached,sw_man_mean_cached)\n","\n","    lista_documentos_filtrados_emb.append([\n","        sw1_id,\n","        sw1_documento,\n","        sw1_janela_documento,\n","        sw1_documentoTokens,\n","        sw1_posDocumento,\n","        sw1_idOcorrencia,\n","        sw1_palavraAlvo,\n","        sw1_grupo,\n","        sw1_obra,\n","        sw1_autor,\n","        sw1_ano,\n","        sw1_idObra,\n","        sw1_movimento,\n","        sw1_length,\n","        sw1_embeddings_janela_mean  \n","    ])\n","\n","    \n","\n","\n","\n","\n","\n","\n","\n","\n","\n","\n","\n","\n","\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"RMncPjJUwQ8i"},"outputs":[],"source":["columnsDataframe = [  \n","'sw1_id',\n","'sw1_documento',\n","'sw1_janela_documento',\n","'sw1_documentoTokens',\n","'sw1_posDocumento',\n","'sw1_idOcorrencia',\n","'sw1_palavraAlvo',\n","'sw1_grupo',\n","'sw1_obra',\n","'sw1_autor',\n","'sw1_ano',\n","'sw1_idObra',\n","'sw1_movimento',\n","'sw1_length',  \n","'sw1_embeddings_janela'   \n","]    "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"jK9x6CkxwkIv"},"outputs":[],"source":["lista_documentos_filtrados_emb_dataframe = pd.DataFrame(lista_documentos_filtrados_emb, columns=columnsDataframe)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"vk9BhHT3T5ro"},"outputs":[],"source":["del lista_documentos_filtrados_emb"]},{"cell_type":"markdown","metadata":{"id":"pcs4G8R7wRpY"},"source":["### 3.2.2 gera medidas entre sentenças"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"referenced_widgets":["2be0fc860f9b4d3b86a06865977a7544"]},"id":"F92sU2_6v07Y","outputId":"c60dac69-84d7-48d2-ead3-8a893ada558a"},"outputs":[{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"2be0fc860f9b4d3b86a06865977a7544","version_major":2,"version_minor":0},"text/plain":["Documentos:   0%|          | 0/1044 [00:00<?, ? documento/s]"]},"metadata":{},"output_type":"display_data"}],"source":["# Import das bibliotecas.\n","from tqdm.notebook import tqdm as tqdm_notebook\n","\n","list_intances = [];\n","\n","# perccore a lista de documento inicio ate final-1\n","documentos_bar = tqdm_notebook(lista_documentos_filtrados_emb_dataframe[:-1].iterrows(), desc=f\"Documentos\", unit=f\" documento\", total=len(lista_documentos_filtrados_emb_dataframe[:-1]))  \n","for index, row in documentos_bar:\n","    \n","    \n","    sw1_id                   = row['sw1_id']\n","    sw1_documento            = row['sw1_documento']\n","    sw1_janela_documento     = row['sw1_janela_documento']\n","    sw1_documentoTokens      = row['sw1_documentoTokens']\n","    sw1_posDocumento         = row['sw1_posDocumento']\n","    sw1_idOcorrencia         = row['sw1_idOcorrencia']\n","    sw1_palavraAlvo          = row['sw1_palavraAlvo']\n","    sw1_grupo                = row['sw1_grupo']\n","    sw1_obra                 = row['sw1_obra']\n","    sw1_autor                = row['sw1_autor']\n","    sw1_ano                  = row['sw1_ano']\n","    sw1_idObra               = row['sw1_idObra']\n","    sw1_movimento            = row['sw1_movimento']\n","    sw1_length               = row['sw1_length'] \n","    sw1_embeddings_janela    = row['sw1_embeddings_janela'] \n","            \n","\n","\n"," \n","\n","    for index2, row2 in lista_documentos_filtrados_emb_dataframe[index+1:].iterrows():\n","\n","        # gerar os embeddings do documento sw2\n","        # print(index,index2)\n","\n","        if row2['sw1_id'] != row['sw1_id'] or row2['sw1_janela_documento'] != row['sw1_janela_documento']:\n","\n","            sw2_id                      = row2['sw1_id']\n","            sw2_documento               = row2['sw1_documento']\n","            sw2_janela_documento        = row2['sw1_janela_documento']\n","            sw2_documentoTokens         = row2['sw1_documentoTokens']\n","            sw2_posDocumento            = row2['sw1_posDocumento']\n","            sw2_idOcorrencia            = row2['sw1_idOcorrencia']\n","            sw2_palavraAlvo             = row2['sw1_palavraAlvo']\n","            sw2_grupo                   = row2['sw1_grupo']\n","            sw2_obra                    = row2['sw1_obra']\n","            sw2_autor                   = row2['sw1_autor']\n","            sw2_ano                     = row2['sw1_ano']\n","            sw2_idObra                  = row2['sw1_idObra']\n","            sw2_movimento               = row2['sw1_movimento']\n","            sw2_length                  = row2['sw1_length'] \n","            sw2_embeddings_janela       = row2['sw1_embeddings_janela'] \n","\n","\n","            similaridade = 1\n","\n","            cos_mean = 1  \n","            euc_mean = 0\n","            man_mean = 0\n","            \n","\n","            cos_mean, euc_mean, man_mean = getMedidasEmbedding(sw1_embeddings_janela,sw2_embeddings_janela)\n","\n","        \n","            \n","\n","            sw_similaridade_cached = cos_mean\n","            sw_cos_mean_cached = cos_mean\n","            sw_euc_mean_cached = euc_mean\n","            sw_man_mean_cached = man_mean\n","            \n","            \n","\n","            list_intances.append([\n","                sw1_id,\n","                sw1_documento,\n","                sw1_janela_documento,\n","                sw1_idOcorrencia,\n","                sw1_palavraAlvo,\n","                sw1_grupo,\n","                sw1_obra,\n","                sw1_autor,\n","                sw1_ano,\n","                sw1_idObra,\n","                sw1_movimento,\n","                sw1_length,\n","                \n","                sw2_id,\n","                sw2_documento,\n","                sw2_janela_documento,\n","                sw2_idOcorrencia,\n","                sw2_palavraAlvo,\n","                sw2_grupo,\n","                sw2_obra,\n","                sw2_autor,\n","                sw2_ano,\n","                sw2_idObra,\n","                sw2_movimento,\n","                sw2_length,\n","                \n","                sw_cos_mean_cached,                                          # valor de similaridade pelo cosseno\n","                sw_euc_mean_cached,                                          # valor da distencia euclidiana \n","                sw_man_mean_cached                                           # valor da distancia manhattan\n","            ])\n","\n","            list_intances.append([\n","                sw2_id,\n","                sw2_documento,\n","                sw2_janela_documento,\n","                sw2_idOcorrencia,\n","                sw2_palavraAlvo,\n","                sw2_grupo,\n","                sw2_obra,\n","                sw2_autor,\n","                sw2_ano,\n","                sw2_idObra,\n","                sw2_movimento,\n","                sw2_length,\n","                sw1_id,\n","                sw1_documento,\n","                sw1_janela_documento,\n","                sw1_idOcorrencia,\n","                sw1_palavraAlvo,\n","                sw1_grupo,\n","                sw1_obra,\n","                sw1_autor,\n","                sw1_ano,\n","                sw1_idObra,\n","                sw1_movimento,\n","                sw1_length,            \n","                sw_cos_mean_cached,                                          # valor de similaridade pelo cosseno\n","                sw_euc_mean_cached,                                          # valor da distencia euclidiana \n","                sw_man_mean_cached                                           # valor da distancia manhattan\n","            ])\n","\n","\n","\n","\n","\n","\n","\n","\n","\n"]},{"cell_type":"markdown","metadata":{"id":"qKTL0eJhN5lJ"},"source":["### Transforma a lista em um dataframe"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"QUdDQOsXI7x5"},"outputs":[],"source":["columnsDataframe = [  \n","'sw1_id',\n","'sw1_documento',\n","'sw1_janela_documento',\n","'sw1_idOcorrencia',\n","'sw1_palavraAlvo',\n","'sw1_grupo',\n","'sw1_obra',\n","'sw1_autor',\n","'sw1_ano',\n","'sw1_idObra',\n","'sw1_movimento',\n","'sw1_length',   \n","'sw2_id',\n","'sw2_documento',\n","'sw2_janela_documento',\n","'sw2_idOcorrencia',\n","'sw2_palavraAlvo',\n","'sw2_grupo',\n","'sw2_obra',\n","'sw2_autor',\n","'sw2_ano',\n","'sw2_idObra',\n","'sw2_movimento',\n","'sw2_length',\n","'cos_mean',\n","'euc_mean',\n","'man_mean',   \n","]    "]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"ek_xEHDqN5lJ"},"outputs":[],"source":["list_intances_df = pd.DataFrame(list_intances, columns=columnsDataframe)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"mZGoACRtTtUB"},"outputs":[],"source":["del list_intances"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"gKP6Z9KdVbTM","outputId":"be254286-77dc-49ae-a009-c0373418fbf3"},"outputs":[{"data":{"text/plain":["1090824"]},"execution_count":114,"metadata":{},"output_type":"execute_result"}],"source":["len(list_intances_df)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"8u4Vzr8jN5lJ","outputId":"2d49d52a-211d-449b-fe7a-e6ddd7a459d4"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-6b84bb0e-6b50-400c-9617-620047be4462\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>sw1_id</th>\n","      <th>sw1_documento</th>\n","      <th>sw1_janela_documento</th>\n","      <th>sw1_idOcorrencia</th>\n","      <th>sw1_palavraAlvo</th>\n","      <th>sw1_grupo</th>\n","      <th>sw1_obra</th>\n","      <th>sw1_autor</th>\n","      <th>sw1_ano</th>\n","      <th>sw1_idObra</th>\n","      <th>...</th>\n","      <th>sw2_grupo</th>\n","      <th>sw2_obra</th>\n","      <th>sw2_autor</th>\n","      <th>sw2_ano</th>\n","      <th>sw2_idObra</th>\n","      <th>sw2_movimento</th>\n","      <th>sw2_length</th>\n","      <th>cos_mean</th>\n","      <th>euc_mean</th>\n","      <th>man_mean</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>148334</th>\n","      <td>200118</td>\n","      <td>A cozinha foi sempre adiantando a sua obra: qu...</td>\n","      <td>as conversas com o senhor para contá-las na co...</td>\n","      <td>55</td>\n","      <td>senhor</td>\n","      <td>senhor</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>...</td>\n","      <td>crioulo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","      <td>9</td>\n","      <td>0.839121</td>\n","      <td>9.139096</td>\n","      <td>224.912352</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>1 rows × 27 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-6b84bb0e-6b50-400c-9617-620047be4462')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-6b84bb0e-6b50-400c-9617-620047be4462 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-6b84bb0e-6b50-400c-9617-620047be4462');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["        sw1_id                                      sw1_documento  \\\n","148334  200118  A cozinha foi sempre adiantando a sua obra: qu...   \n","\n","                                     sw1_janela_documento  sw1_idOcorrencia  \\\n","148334  as conversas com o senhor para contá-las na co...                55   \n","\n","       sw1_palavraAlvo sw1_grupo            sw1_obra  \\\n","148334          senhor    senhor  As Vítimas-Algozes   \n","\n","                       sw1_autor  sw1_ano  sw1_idObra  ... sw2_grupo  \\\n","148334  Joaquim Manuel de Macedo     1869           2  ...   crioulo   \n","\n","                  sw2_obra                 sw2_autor sw2_ano sw2_idObra  \\\n","148334  As Vítimas-Algozes  Joaquim Manuel de Macedo    1869          2   \n","\n","        sw2_movimento sw2_length  cos_mean  euc_mean    man_mean  \n","148334     Romantismo          9  0.839121  9.139096  224.912352  \n","\n","[1 rows x 27 columns]"]},"execution_count":115,"metadata":{},"output_type":"execute_result"}],"source":["list_intances_df.sample() "]},{"cell_type":"markdown","metadata":{"id":"-hfUpvKqXoqe"},"source":["#### Corrigir o tipo de dados da coluna\n","\n","Em dados:\n","- coluna 1 - `lista_embeddings_mean` é do tipo tensor.\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"lj9sJVavMccj","outputId":"e8fd9567-f8da-40b2-c1b4-a6b1028caf70"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:TERMINADO CORREÇÃO list_intances_df: 1090824.\n"]}],"source":["# Import das bibliotecas.\n","import ast # Biblioteca para conversão de string em lista\n","\n","# Converte o tipo da coluna de tensor para list\n","\n","# list_intances_df[\"sw2_lista_embeddings_mean\"] = list_intances_df[\"sw2_lista_embeddings_mean\"].apply(lambda x: x.numpy())\n","# list_intances_df[\"sw2_lista_embeddings_mean\"] = list_intances_df[\"sw2_lista_embeddings_mean\"].apply(lambda x: x.tolist())\n","\n","# list_intances_df[\"sw1_lista_embeddings_mean\"] = list_intances_df[\"sw1_lista_embeddings_mean\"].apply(lambda x: x.numpy())\n","# list_intances_df[\"sw1_lista_embeddings_mean\"] = list_intances_df[\"sw1_lista_embeddings_mean\"].apply(lambda x: x.tolist())\n","\n","\n","logging.info(\"TERMINADO CORREÇÃO list_intances_df: {}.\".format(len(list_intances_df)))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"GecavbpXN5lJ"},"outputs":[],"source":["# Nome do arquivo original\n","NOME_ARQUIVO_PARES_INSTANCIAS = \"pares_medidas_entre_sentencas_\"+str(TAMANHO_JANELA)+\"_vitimas_algoz.csv\"\n","# NOME_ARQUIVO_PARES_INSTANCIAS = \"pares_medidas_entre_sentencas_\"+str(TAMANHO_JANELA)+\".csv\"\n","\n","NOME_ARQUIVO_PARES_INSTANCIAS_COMPACTADO = \"pares_medidas_entre_sentencas_\"+str(TAMANHO_JANELA)+\"_vitimas_algoz.zip\"\n","# NOME_ARQUIVO_PARES_INSTANCIAS_COMPACTADO = \"pares_medidas_entre_sentencas_\"+str(TAMANHO_JANELA)+\".zip\"\n","\n","\n","nome_arquivo_FILTRADO = DIRETORIO_LOCAL + NOME_ARQUIVO_PARES_INSTANCIAS\n","\n","# Salva o arquivo original filtrado\n","list_intances_df.to_csv(nome_arquivo_FILTRADO,  sep=\";\", index=False)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"t8-eWGcqN5lJ"},"outputs":[],"source":["!zip -o -j -q \"$DIRETORIO_LOCAL$NOME_ARQUIVO_PARES_INSTANCIAS_COMPACTADO\" \"$DIRETORIO_LOCAL$NOME_ARQUIVO_PARES_INSTANCIAS\""]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"VNK720oLN5lJ","outputId":"e48653db-386c-4753-87e7-9ec86c7f9401"},"outputs":[{"name":"stderr","output_type":"stream","text":["INFO:root:Terminei a cópia do arquivo.\n"]}],"source":["# Se estiver executando no Google Colaboratory\n","if IN_COLAB:\n","   \n","    # Copia o arquivo das comparações para o google drive\n","    !cp \"$DIRETORIO_LOCAL$NOME_ARQUIVO_PARES_INSTANCIAS_COMPACTADO\" \"$DIRETORIO_DRIVE\"\n","    \n","    logging.info(\"Terminei a cópia do arquivo.\")"]},{"cell_type":"markdown","metadata":{"id":"7YKlCCRH0ZfC"},"source":["Transforma a lista em um dataframe"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"yBOy6rjZTrN6"},"outputs":[],"source":["del list_intances_df"]},{"cell_type":"markdown","metadata":{"id":"TkncKDN1i7kq"},"source":["### 3.3.3 Carrega os dados\n","\n","Carrega os dados das documentos a partir do arquivo."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"pTVxFPqg5wY_"},"outputs":[],"source":["# Import das bibliotecas.\n","import pandas as pd\n","\n","# Abre o arquivo e retorna o DataFrame\n","df_list_intances = pd.read_csv(DIRETORIO_LOCAL + NOME_ARQUIVO_PARES_INSTANCIAS, sep=\";\", encoding=\"UTF-8\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"tlPKkZKz50j2","outputId":"61f6a2ba-8d22-4cd2-e32d-28bb88a0940a"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-89b77605-b43e-4ff6-8f56-ca9382ce0584\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>sw1_id</th>\n","      <th>sw1_documento</th>\n","      <th>sw1_janela_documento</th>\n","      <th>sw1_idOcorrencia</th>\n","      <th>sw1_palavraAlvo</th>\n","      <th>sw1_grupo</th>\n","      <th>sw1_obra</th>\n","      <th>sw1_autor</th>\n","      <th>sw1_ano</th>\n","      <th>sw1_idObra</th>\n","      <th>...</th>\n","      <th>sw2_grupo</th>\n","      <th>sw2_obra</th>\n","      <th>sw2_autor</th>\n","      <th>sw2_ano</th>\n","      <th>sw2_idObra</th>\n","      <th>sw2_movimento</th>\n","      <th>sw2_length</th>\n","      <th>cos_mean</th>\n","      <th>euc_mean</th>\n","      <th>man_mean</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>706293</th>\n","      <td>202098</td>\n","      <td>O louco riu-se com agrado, escutando a exclama...</td>\n","      <td>escutando a exclamação da crioula , e entregan...</td>\n","      <td>10</td>\n","      <td>crioula</td>\n","      <td>crioulo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>...</td>\n","      <td>escravo</td>\n","      <td>As Vítimas-Algozes</td>\n","      <td>Joaquim Manuel de Macedo</td>\n","      <td>1869</td>\n","      <td>2</td>\n","      <td>Romantismo</td>\n","      <td>9</td>\n","      <td>0.808536</td>\n","      <td>10.079502</td>\n","      <td>249.954784</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>1 rows × 27 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-89b77605-b43e-4ff6-8f56-ca9382ce0584')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-89b77605-b43e-4ff6-8f56-ca9382ce0584 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-89b77605-b43e-4ff6-8f56-ca9382ce0584');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["        sw1_id                                      sw1_documento  \\\n","706293  202098  O louco riu-se com agrado, escutando a exclama...   \n","\n","                                     sw1_janela_documento  sw1_idOcorrencia  \\\n","706293  escutando a exclamação da crioula , e entregan...                10   \n","\n","       sw1_palavraAlvo sw1_grupo            sw1_obra  \\\n","706293         crioula   crioulo  As Vítimas-Algozes   \n","\n","                       sw1_autor  sw1_ano  sw1_idObra  ... sw2_grupo  \\\n","706293  Joaquim Manuel de Macedo     1869           2  ...   escravo   \n","\n","                  sw2_obra                 sw2_autor sw2_ano sw2_idObra  \\\n","706293  As Vítimas-Algozes  Joaquim Manuel de Macedo    1869          2   \n","\n","        sw2_movimento sw2_length  cos_mean   euc_mean    man_mean  \n","706293     Romantismo          9  0.808536  10.079502  249.954784  \n","\n","[1 rows x 27 columns]"]},"execution_count":122,"metadata":{},"output_type":"execute_result"}],"source":["df_list_intances.sample()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"BdiOKmFhYsca","outputId":"5e94b92c-0a07-46af-feaf-6aa91ddd8abc"},"outputs":[{"data":{"text/plain":["716"]},"execution_count":123,"metadata":{},"output_type":"execute_result"}],"source":["len(df_list_intances['sw1_id'].unique())"]},{"cell_type":"markdown","metadata":{"id":"Yj0ya60zrm8t"},"source":["# 4 Finalização"]},{"cell_type":"markdown","metadata":{"id":"Bcjt085lZGUr"},"source":["## 4.1 Tempo final de processamento\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"H50_GKJwpDha","outputId":"9b28d108-4922-4131-af76-05255a01c32d"},"outputs":[{"name":"stdout","output_type":"stream","text":["\n","  Tempo processamento:  0:30:14 (h:mm:ss)\n"]}],"source":["# Pega o tempo atual menos o tempo do início do processamento.\n","final_processamento = time.time()\n","tempo_total_processamento = formataTempo(final_processamento - inicio_processamento)\n","\n","print(\"\")\n","print(\"  Tempo processamento:  {:} (h:mm:ss)\".format(tempo_total_processamento))"]}],"metadata":{"colab":{"collapsed_sections":["EKOTlwcmxmej","PKUr9Vk4BNLC","GOcN8hK-scnt","iAPVtRXQqDim","_GjYtXcMnSAe","RinFHFesVKis","Pqa-7WXBAw8q","SUxlx7Sx4yxj","L7G3-MOsQ1N_","AEzytjZi5Iw2","onM1ZApom-_W","6ZVwbmn3Nx2t","Jxe-mh-l6sJY","m4KV_jI-Nx2w","bGaf7bkpAEiX","ZB6bR42PA28c","B4Soqt3fp3Lu","ENvsIER06sJX","b01WgMSSKY_u","TouR4GjNJZD6","_xaeX0oTVQ5t","MBGTMy8Ic7GK","uiuxdXe9t1BX","rHt4e5pAcEMd","V74WUpHqcfoI","eaneOhAKcO-3","6tKcaIfReqdy","e8n7Z5s-QZF8","-pZZrUKRhR3e","-uFDhRTZe2Js","d7KprWqyZBQZ","lCJzsw8T0I-5","s42mgtmSZ8MR","q7nx_eZ8hSlr","-rLcMuDHC-F5","zFd1rse11DpZ","3wvgXwN81RCz","kGL37G6XFcwp","L_vknrk7YSpF","JplTToZvDLiX","xKaqQPs8VQ5u","fazAuLMUr_c0","S6A6-Xwg8GJw","Usr1uRzQeJSb","Yj0ya60zrm8t","Bcjt085lZGUr"],"provenance":[{"file_id":"1q3JTcgbWA46Zih94jwddt39KFLhyntww","timestamp":1663731761602},{"file_id":"1MGqfSbWIJImPFuCcPnfbG9-XJNkYsAoP","timestamp":1663257809933},{"file_id":"1fa1ZrVSmNY6tEau6KIW0M3PxcITiS9cs","timestamp":1663065419767},{"file_id":"1ZQvuAVwA3IjybezQOXnrXMGAnMyZRuPU","timestamp":1585340447636},{"file_id":"1FsBCkREOaDopLF3PIYUuQxLR8wRfjQY1","timestamp":1559844903389},{"file_id":"1f_snPs--PVYgZJwT3GwjxqVALFJ0T2-y","timestamp":1554843110227}],"toc_visible":true},"kernelspec":{"display_name":"Python 3","name":"python3"},"widgets":{"application/vnd.jupyter.widget-state+json":{"004a1427cceb4ee8ad5f6fa302801909":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_4182d87f3d03406480c09e4089521018","placeholder":"​","style":"IPY_MODEL_684dbbf334c04970b27575dadaf1d750","value":"Downloading: 100%"}},"0653908463664c84a02f2920399fe6a4":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"077c9d8f1e2c47f08fe7fddd63848fbb":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"07b20c22272146c09e5d724fbde226da":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"08ed280b109f4fceabab67030ae185b2":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"09d95a0ffa934d7982d1ef813bc10d68":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"0b5774bc70324a328c7dc755eb6227de":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_08ed280b109f4fceabab67030ae185b2","placeholder":"​","style":"IPY_MODEL_39701e4d4f0e417bae2a84572c66366d","value":" 6/1843 [00:06&lt;24:27,  1.25 documento/s]"}},"0f09ac35ac464a82b543e1a8569cee7b":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"172119c99ceb418e95c725bf9b3b134b":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"173151d74d43455db61325c4048949e5":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_c3ac523c875f4a5188bc9dcb1aa0891a","max":2,"min":0,"orientation":"horizontal","style":"IPY_MODEL_7f85e20e8d1f405cb8f028712e4a4034","value":2}},"1827198a686a498a9b076c3a7768bc87":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_a7e9d1e38e54460d887520f86e0251ea","placeholder":"​","style":"IPY_MODEL_2af2461f1676494cac53346e941f8871","value":"Downloading: 100%"}},"1a62f2db617448e6b16cb17821f51fba":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1b91feea2b9b4508b181a9aa34512897":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_cb45900d2ed74920b05c65b749d9dd23","IPY_MODEL_ba19c059456c417d948a95a8704c42f8","IPY_MODEL_2bc21b015ba14f7ca0a4efa10bcc4ae6"],"layout":"IPY_MODEL_07b20c22272146c09e5d724fbde226da"}},"1bf025459b4041b69b812b737f65eb99":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_e0a82ba5aa4f4feb8b244367293cf1f5","IPY_MODEL_de2dbeda7ec24a618a8a223bff8d439f","IPY_MODEL_e17195dc57c241ee85dab7501b4ac708"],"layout":"IPY_MODEL_ebf06da1539c44bc950a89f672f9f9d5"}},"2466d2a6bc244d6f91483ca3525d4725":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_688e568a85f345e6bca01cca417b2be6","IPY_MODEL_173151d74d43455db61325c4048949e5","IPY_MODEL_8e03e93ddd8f44c197c807e3fd4e6061"],"layout":"IPY_MODEL_5a6388c435d845e6a791e0e49d3f2233"}},"25fcd7f4c299465db83481c11fdf4276":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"287de2f7aaaa4e26900b4370e7401a04":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"28c0c75fb4c94bf4b3b8850f5c1a6798":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2af2461f1676494cac53346e941f8871":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2b979a433f5f49938aaf7e258c66303e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_004a1427cceb4ee8ad5f6fa302801909","IPY_MODEL_32785ee343b94c99b6e4be5d3af1a2bb","IPY_MODEL_e33f9a34b050486398fe400c1afdae01"],"layout":"IPY_MODEL_ab74ff9e90334ed8964f04913a8ea009"}},"2bc21b015ba14f7ca0a4efa10bcc4ae6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_63f38f30513944c792f07e4434bd797d","placeholder":"​","style":"IPY_MODEL_bb73149b473446bebd649457335d14cc","value":" 112/112 [00:00&lt;00:00, 2.41kB/s]"}},"32785ee343b94c99b6e4be5d3af1a2bb":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_e01f52a9da964f7db763da8c536b55c0","max":648,"min":0,"orientation":"horizontal","style":"IPY_MODEL_58f6431181974080983170c0ce2ba1de","value":648}},"3730b067e9ab4c36b7b3a1ab492ccc64":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"39701e4d4f0e417bae2a84572c66366d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"39ea44f31baa448ca313fef525595fbf":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3ad094efc38440369652f4262b0698c6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e0a9258e8efa4871b24cfa46ed0db1bf","placeholder":"​","style":"IPY_MODEL_f96b23a4db61425c8538952617964520","value":"Documentos:   0%"}},"4182d87f3d03406480c09e4089521018":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"58f6431181974080983170c0ce2ba1de":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"5a6388c435d845e6a791e0e49d3f2233":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"63f38f30513944c792f07e4434bd797d":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"684dbbf334c04970b27575dadaf1d750":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"688e568a85f345e6bca01cca417b2be6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_172119c99ceb418e95c725bf9b3b134b","placeholder":"​","style":"IPY_MODEL_aa7337611a204007a4939ce2ff845aac","value":"Downloading: 100%"}},"6c74147767ea4ca9a484c4799af7290d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"","description":"","description_tooltip":null,"layout":"IPY_MODEL_077c9d8f1e2c47f08fe7fddd63848fbb","max":1843,"min":0,"orientation":"horizontal","style":"IPY_MODEL_287de2f7aaaa4e26900b4370e7401a04","value":6}},"6f38837e61d244a5b5bd09b2aa73ecfe":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"729c916fc5d943d387616bf182eb67d7":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"74ffdf9a54e74bf3bad8a37f82f287a5":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7f56a660fe1a45ce9cbdbb17c7d3f6f3":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7f85e20e8d1f405cb8f028712e4a4034":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"87c39e51ab5046c4b88d7bccb9cc745a":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_b0b275c579024ed4bdad8388417851ab","IPY_MODEL_ac3143e2717b45ca9f58102a1cc7f8e6","IPY_MODEL_ae720d154701455a85ce1d5c7a2c31b1"],"layout":"IPY_MODEL_a472850d481240a286cdaa74f2b44881"}},"87fa56e0b40d4dbda3cee1cebf5c92ed":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8b554757975547d489e1525261f9ca19":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_1827198a686a498a9b076c3a7768bc87","IPY_MODEL_eb077a63eb764a8984581b1c309ff69c","IPY_MODEL_ba1d0fbc835a4dd1a7b8e45c0e07a952"],"layout":"IPY_MODEL_fa79fca08ed048498308eaf6535f4e31"}},"8beec1d6adf047db93139a0e395bfad0":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_3ad094efc38440369652f4262b0698c6","IPY_MODEL_6c74147767ea4ca9a484c4799af7290d","IPY_MODEL_0b5774bc70324a328c7dc755eb6227de"],"layout":"IPY_MODEL_6f38837e61d244a5b5bd09b2aa73ecfe"}},"8e03e93ddd8f44c197c807e3fd4e6061":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_c0dcf6400f4d4572bb0846d86ea85add","placeholder":"​","style":"IPY_MODEL_b0aec44c7f6643bea5455ae86e839ba7","value":" 2.00/2.00 [00:00&lt;00:00, 38.5B/s]"}},"9954d08b8d2f44189c155f6b6f7dedd1":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9960d7e850394a92affee1f7debdbc92":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"9c3b99a610f0433d9ec5e84babbe555b":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a472850d481240a286cdaa74f2b44881":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a7e9d1e38e54460d887520f86e0251ea":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"aa7337611a204007a4939ce2ff845aac":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"ab74ff9e90334ed8964f04913a8ea009":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ac3143e2717b45ca9f58102a1cc7f8e6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_87fa56e0b40d4dbda3cee1cebf5c92ed","max":155,"min":0,"orientation":"horizontal","style":"IPY_MODEL_f3d06a93e645486186105154245f3f0d","value":155}},"ae720d154701455a85ce1d5c7a2c31b1":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f08d67e402db477a922d686b0a4200d4","placeholder":"​","style":"IPY_MODEL_09d95a0ffa934d7982d1ef813bc10d68","value":" 155/155 [00:00&lt;00:00, 3.37kB/s]"}},"b0aec44c7f6643bea5455ae86e839ba7":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"b0b275c579024ed4bdad8388417851ab":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_d46ca0dfbfef4fb187c9f27166297336","placeholder":"​","style":"IPY_MODEL_9c3b99a610f0433d9ec5e84babbe555b","value":"Downloading: 100%"}},"b3de34c905ce4406b19af9772b028a57":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ba19c059456c417d948a95a8704c42f8":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_b3de34c905ce4406b19af9772b028a57","max":112,"min":0,"orientation":"horizontal","style":"IPY_MODEL_9960d7e850394a92affee1f7debdbc92","value":112}},"ba1d0fbc835a4dd1a7b8e45c0e07a952":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_729c916fc5d943d387616bf182eb67d7","placeholder":"​","style":"IPY_MODEL_f3c5b2ec2f4d4505ad66b214f6ee002d","value":" 1.34G/1.34G [00:21&lt;00:00, 66.2MB/s]"}},"bb73149b473446bebd649457335d14cc":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"c0dcf6400f4d4572bb0846d86ea85add":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c3ac523c875f4a5188bc9dcb1aa0891a":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"cb45900d2ed74920b05c65b749d9dd23":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_25fcd7f4c299465db83481c11fdf4276","placeholder":"​","style":"IPY_MODEL_0653908463664c84a02f2920399fe6a4","value":"Downloading: 100%"}},"d46ca0dfbfef4fb187c9f27166297336":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"de2dbeda7ec24a618a8a223bff8d439f":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_7f56a660fe1a45ce9cbdbb17c7d3f6f3","max":209528,"min":0,"orientation":"horizontal","style":"IPY_MODEL_3730b067e9ab4c36b7b3a1ab492ccc64","value":209528}},"e01f52a9da964f7db763da8c536b55c0":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e0a82ba5aa4f4feb8b244367293cf1f5":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_1a62f2db617448e6b16cb17821f51fba","placeholder":"​","style":"IPY_MODEL_0f09ac35ac464a82b543e1a8569cee7b","value":"Downloading: 100%"}},"e0a9258e8efa4871b24cfa46ed0db1bf":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e17195dc57c241ee85dab7501b4ac708":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_74ffdf9a54e74bf3bad8a37f82f287a5","placeholder":"​","style":"IPY_MODEL_28c0c75fb4c94bf4b3b8850f5c1a6798","value":" 210k/210k [00:00&lt;00:00, 806kB/s]"}},"e33f9a34b050486398fe400c1afdae01":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_9954d08b8d2f44189c155f6b6f7dedd1","placeholder":"​","style":"IPY_MODEL_f3024a9af517450992f03911274bc434","value":" 648/648 [00:00&lt;00:00, 17.4kB/s]"}},"eb077a63eb764a8984581b1c309ff69c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_39ea44f31baa448ca313fef525595fbf","max":1342014951,"min":0,"orientation":"horizontal","style":"IPY_MODEL_f1eb4f59df4f46b9a5bb3f4315546967","value":1342014951}},"ebf06da1539c44bc950a89f672f9f9d5":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f08d67e402db477a922d686b0a4200d4":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f1eb4f59df4f46b9a5bb3f4315546967":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"f3024a9af517450992f03911274bc434":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"f3c5b2ec2f4d4505ad66b214f6ee002d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"f3d06a93e645486186105154245f3f0d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"f96b23a4db61425c8538952617964520":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"fa79fca08ed048498308eaf6535f4e31":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}}}}},"nbformat":4,"nbformat_minor":0}